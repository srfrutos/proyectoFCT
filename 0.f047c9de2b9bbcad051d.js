(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"I/3d":function(t,e,n){"use strict";n.d(e,"a",function(){return Yd});var r=n("fXoL"),i=n("D0XW"),o=n("HDdC"),s=n("Cfvw"),a=n("LRne"),u=n("JX91"),c=n("Zy1z"),h=n("lJxs"),l=n("Kqap"),f=n("/uUt"),d=n("pLZG"),p=n("pxpQ"),y=n("spgP"),v=n("ofXK"),g=n("Jgta"),m=n("zIRd"),b=n("qOnz"),w=n("q/0M"),I=function(t,e){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function E(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var T,_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},O=O||{},S=_||self;function D(){}function N(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function A(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var j="closure_uid_"+(1e9*Math.random()>>>0),k=0;function C(t,e,n){return t.call.apply(t.bind,arguments)}function x(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function R(t,e,n){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?C:x).apply(null,arguments)}function P(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function L(){return Date.now()}function M(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function F(){this.j=this.j,this.i=this.i}F.prototype.j=!1,F.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,j)&&t[j]||(t[j]=++k)}(this)},F.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function V(t){return Array.prototype.concat.apply([],arguments)}function B(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var G,z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function H(t,e){return t<e?-1:t>e?1:0}t:{var W=S.navigator;if(W){var X=W.userAgent;if(X){G=X;break t}}G=""}function Y(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function J(t){var e={};for(var n in t)e[n]=t[n];return e}var $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<$.length;o++)n=$[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function tt(t){return tt[" "](t),t}tt[" "]=D;var et,nt,rt=Q(G,"Opera"),it=Q(G,"Trident")||Q(G,"MSIE"),ot=Q(G,"Edge"),st=ot||it,at=Q(G,"Gecko")&&!(Q(G.toLowerCase(),"webkit")&&!Q(G,"Edge"))&&!(Q(G,"Trident")||Q(G,"MSIE"))&&!Q(G,"Edge"),ut=Q(G.toLowerCase(),"webkit")&&!Q(G,"Edge");function ct(){var t=S.document;return t?t.documentMode:void 0}t:{var ht="",lt=(nt=G,at?/rv:([^\);]+)(\)|;)/.exec(nt):ot?/Edge\/([\d\.]+)/.exec(nt):it?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(nt):ut?/WebKit\/(\S+)/.exec(nt):rt?/(?:Version)[ \/]?(\S+)/.exec(nt):void 0);if(lt&&(ht=lt?lt[1]:""),it){var ft=ct();if(null!=ft&&ft>parseFloat(ht)){et=String(ft);break t}}et=ht}var dt={};function pt(t){return function(t,e){var n=dt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=z(String(et)).split("."),r=z(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=H(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||H(0==s[2].length,0==a[2].length)||H(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var yt=S.document&&it&&(ct()||parseInt(et,10))||void 0,vt=!it||9<=Number(yt),gt=it&&!pt("9"),mt=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",D,e),S.removeEventListener("test",D,e)}catch(n){}return t}();function bt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function wt(t,e){if(bt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(at){t:{try{tt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:It[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}bt.prototype.b=function(){this.defaultPrevented=!0},M(wt,bt);var It={2:"touch",3:"pen",4:"mouse"};wt.prototype.b=function(){wt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var Et="closure_listenable_"+(1e6*Math.random()|0),Tt=0;function _t(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Tt,this.Y=this.Z=!1}function Ot(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function St(t){this.src=t,this.a={},this.b=0}function Dt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=q(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Ot(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Nt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}St.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Nt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new _t(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var At="closure_lm_"+(1e6*Math.random()|0),jt={};function kt(t,e,n,r,i){if(r&&r.once)return xt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)kt(t,e[o],n,r,i);return null}return n=Vt(n),t&&t[Et]?t.va(e,n,A(r)?!!r.capture:!!r,i):Ct(t,e,n,!1,r,i)}function Ct(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=A(i)?!!i.capture:!!i;if(s&&!vt)return null;var a=qt(t);if(a||(t[At]=a=new St(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Ft,e=vt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)mt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Lt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function xt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)xt(t,e[o],n,r,i);return null}return n=Vt(n),t&&t[Et]?t.wa(e,n,A(r)?!!r.capture:!!r,i):Ct(t,e,n,!0,r,i)}function Rt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);else r=A(r)?!!r.capture:!!r,n=Vt(n),t&&t[Et]?(t=t.c,(e=String(e).toString())in t.a&&-1<(n=Nt(o=t.a[e],n,r,i))&&(Ot(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=qt(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Nt(e,n,r,i)),(n=-1<t?e[t]:null)&&Pt(n))}function Pt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Et])Dt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Lt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=qt(e))?(Dt(n,t),0==n.b&&(n.src=null,e[At]=null)):Ot(t)}}}function Lt(t){return t in jt?jt[t]:jt[t]="on"+t}function Mt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Pt(t),n.call(r,e)}function Ft(t,e){if(t.Y)return!0;if(!vt){if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Mt(t,e=new wt(e,this))}return Mt(t,new wt(e,this))}function qt(t){return(t=t[At])instanceof St?t:null}var Ut="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vt(t){return"function"==typeof t?t:(t[Ut]||(t[Ut]=function(e){return t.handleEvent(e)}),t[Ut])}function Bt(){F.call(this),this.c=new St(this),this.J=this,this.C=null}function Kt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new bt(e,t);else if(e instanceof bt)e.target=e.target||t;else{var i=e;Z(e=new bt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=Gt(s,r,!0,e)&&i}if(i=Gt(s=e.a=t,r,!0,e)&&i,i=Gt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Gt(s=e.a=n[o],r,!1,e)&&i}function Gt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&Dt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}M(Bt,F),Bt.prototype[Et]=!0,(T=Bt.prototype).addEventListener=function(t,e,n,r){kt(this,t,e,n,r)},T.removeEventListener=function(t,e,n,r){Rt(this,t,e,n,r)},T.G=function(){if(Bt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ot(n[r]);delete e.a[t],e.b--}}this.C=null},T.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},T.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var zt=S.JSON.stringify;function Qt(){this.b=this.a=null}var Ht,Wt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())(function(){return new Yt},function(t){t.reset()});function Xt(){var t=te,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Yt(){this.next=this.b=this.a=null}function Jt(t){S.setTimeout(function(){throw t},0)}function $t(t,e){Ht||function(){var t=S.Promise.resolve(void 0);Ht=function(){t.then(ee)}}(),Zt||(Ht(),Zt=!0),te.add(t,e)}Qt.prototype.add=function(t,e){var n=Wt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Yt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Yt.prototype.reset=function(){this.next=this.b=this.a=null};var Zt=!1,te=new Qt;function ee(){for(var t;t=Xt();){try{t.a.call(t.b)}catch(n){Jt(n)}var e=Wt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Zt=!1}function ne(t,e){Bt.call(this),this.b=t||1,this.a=e||S,this.f=R(this.Za,this),this.g=L()}function re(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ie(t,e,n){if("function"==typeof t)n&&(t=R(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=R(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}function oe(t){t.a=ie(function(){t.a=null,t.c&&(t.c=!1,oe(t))},t.h);var e=t.b;t.b=null,t.g.apply(null,e)}M(ne,Bt),(T=ne.prototype).aa=!1,T.M=null,T.Za=function(){if(this.aa){var t=L()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Kt(this,"tick"),this.aa&&(re(this),this.start()))}},T.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=L())},T.G=function(){ne.X.G.call(this),re(this),delete this.a};var se=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}I(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:oe(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(S.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(F);function ae(t){F.call(this),this.b=t,this.a={}}M(ae,F);var ue=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var i=0;i<n.length;i++){var o=kt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){Y(t.a,function(t,e){this.a.hasOwnProperty(e)&&Pt(t)},t),t.a={}}function le(){this.a=!0}function fe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return zt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}ae.prototype.G=function(){ae.X.G.call(this),he(this)},ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},le.prototype.info=function(){};var de={},pe=null;function ye(){return pe=pe||new Bt}function ve(t){bt.call(this,de.Fa,t)}function ge(t){var e=ye();Kt(e,new ve(e,t))}function me(t,e){bt.call(this,de.STAT_EVENT,t),this.stat=e}function be(t){var e=ye();Kt(e,new me(e,t))}function we(t){bt.call(this,de.Ga,t)}function Ie(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}de.Fa="serverreachability",M(ve,bt),de.STAT_EVENT="statevent",M(me,bt),de.Ga="timingevent",M(we,bt);var Ee={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Te={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function _e(){}function Oe(){}_e.prototype.a=null;var Se,De={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Ne(){bt.call(this,"d")}function Ae(){bt.call(this,"c")}function je(){}function ke(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ae(this),this.P=Ce,this.R=new ne(t=st?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}M(Ne,bt),M(Ae,bt),M(je,_e),Se=new je;var Ce=45e3,xe={},Re={};function Pe(t,e,n){t.H=1,t.i=rn(Je(e)),t.j=n,t.I=!0,Le(t,null)}function Le(t,e){t.u=L(),qe(t),t.l=Je(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),gn(n.b,"t",r),t.D=0,t.a=lr(t.g,t.g.C?e:null),0<t.O&&(t.F=new se(R(t.Ca,t,t.a),t.O)),ce(t.J,t.a,"readystatechange",t.Xa),e=t.B?J(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ge(1),function(t,e,n,r,i,o){t.info(function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.c,t.m,t.l,t.f,t.S,t.j)}function Me(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Fe(t,n);if(i==Re){4==e&&(t.h=4,be(14),r=!1),fe(t.c,t.f,null,"[Incomplete Response]");break}if(i==xe){t.h=4,be(15),fe(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}fe(t.c,t.f,i,null),Ge(t,i)}4==e&&0==n.length&&(t.h=1,be(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),rr(e),e.F=!0,be(11))):(fe(t.c,t.f,n,"[Invalid Chunked Response]"),Ke(t),Be(t))}function Fe(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Re:(n=Number(e.substring(n,r)),isNaN(n)?xe:(r+=1)+n>e.length?Re:(e=e.substr(r,n),t.D=r+n,e))}function qe(t){t.T=L()+t.P,Ue(t,t.P)}function Ue(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ie(R(t.Va,t),e)}function Ve(t){t.o&&(S.clearTimeout(t.o),t.o=null)}function Be(t){0==t.g.v||t.A||sr(t.g,t)}function Ke(t){Ve(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,re(t.R),he(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ge(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||_n(n.b,t)))if(n.I=t.N,!t.C&&_n(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(Xf){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;or(n),Wn(n)}nr(n),be(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=Ie(R(n.Sa,n),6e3));if(1>=Tn(n.b)&&n.ea){try{n.ea()}catch(Xf){}n.ea=void 0}}else ur(n,11)}else if((t.C||n.a==t)&&or(n),!K(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(Q(h,"spdy")||Q(h,"quic")||Q(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(On(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,nn(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=L()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=hr(u,u.C?u.ga:null,u.fa),d.C){Sn(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(Ve(p),qe(p)),u.a=d}else er(u);0<n.g.length&&Jn(n)}else"stop"!=i[0]&&"close"!=i[0]||ur(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ur(n,7):Hn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);ge(4)}catch(Xf){}}function ze(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(N(t)||"string"==typeof t)U(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(N(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(N(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Qe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Qe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function He(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];We(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)We(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function We(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(T=ke.prototype).setTimeout=function(t){this.P=t},T.Xa=function(t){t=t.target;var e=this.F;e&&3==Kn(t)?e.f():this.Ca(t)},T.Ca=function(t){try{if(t==this.a)t:{var e=Kn(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!st&&!this.a.$())){this.A||4!=e||7==n||ge(8==n||0>=r?3:2),Ve(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,be(12),Ke(this),Be(this);break t}fe(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ge(this,u)}this.I?(Me(this,e,o),st&&this.b&&3==e&&(ce(this.J,this.R,"tick",this.Wa),this.R.start())):(fe(this.c,this.f,o,null),Ge(this,o)),4==e&&Ke(this),this.b&&!this.A&&(4==e?sr(this.g,this):(this.b=!1,qe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,be(12)):(this.h=0,be(13)),Ke(this),Be(this)}}}catch(c){}},T.Wa=function(){if(this.a){var t=Kn(this.a),e=this.a.$();this.D<e.length&&(Ve(this),Me(this,t,e),this.b&&4!=t&&qe(this))}},T.cancel=function(){this.A=!0,Ke(this)},T.Va=function(){this.o=null;var t=L();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(ge(3),be(17)),Ke(this),this.h=2,Be(this)):Ue(this,this.T-t)},(T=Qe.prototype).K=function(){He(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},T.L=function(){return He(this),this.a.concat()},T.get=function(t,e){return We(this.b,t)?this.b[t]:e},T.set=function(t,e){We(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},T.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Xe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ye){this.a=void 0!==e?e:t.a,$e(this,t.f),this.j=t.j,Ze(this,t.c),tn(this,t.h),this.g=t.g,e=t.b;var n=new dn;n.c=e.c,e.a&&(n.a=new Qe(e.a),n.b=e.b),en(this,n),this.i=t.i}else t&&(n=String(t).match(Xe))?(this.a=!!e,$e(this,n[1]||"",!0),this.j=on(n[2]||""),Ze(this,n[3]||"",!0),tn(this,n[4]),this.g=on(n[5]||"",!0),en(this,n[6]||"",!0),this.i=on(n[7]||"")):(this.a=!!e,this.b=new dn(null,this.a))}function Je(t){return new Ye(t)}function $e(t,e,n){t.f=n?on(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ze(t,e,n){t.c=n?on(e,!0):e}function tn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function en(t,e,n){e instanceof dn?(t.b=e,function(t,e){e&&!t.f&&(pn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(yn(this,e),gn(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=sn(e,ln)),t.b=new dn(e,t.a))}function nn(t,e,n){t.b.set(e,n)}function rn(t){return nn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^L()).toString(36)),t}function on(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function sn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,an),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function an(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.f;e&&t.push(sn(e,un,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(sn(e,un,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(sn(n,"/"==n.charAt(0)?hn:cn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",sn(n,fn)),t.join("")};var un=/[#\/\?@]/g,cn=/[#\?:]/g,hn=/[#\?]/g,ln=/[#\?@]/g,fn=/#/g;function dn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function pn(t){t.a||(t.a=new Qe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function yn(t,e){pn(t),e=mn(t,e),We(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,We((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&He(t)))}function vn(t,e){return pn(t),e=mn(t,e),We(t.a.b,e)}function gn(t,e,n){yn(t,e),0<n.length&&(t.c=null,t.a.set(mn(t,e),B(n)),t.b+=n.length)}function mn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(T=dn.prototype).add=function(t,e){pn(this),this.c=null,t=mn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},T.forEach=function(t,e){pn(this),this.a.forEach(function(n,r){U(n,function(n){t.call(e,n,r,this)},this)},this)},T.L=function(){pn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},T.K=function(t){pn(this);var e=[];if("string"==typeof t)vn(this,t)&&(e=V(e,this.a.get(mn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=V(e,t[n])}return e},T.set=function(t,e){return pn(this),this.c=null,vn(this,t=mn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},T.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},T.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var bn=function(){return function(t,e){this.b=t,this.a=e}}();function wn(t){this.g=t||In,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ia&&S.ia.ya&&S.ia.ya()&&S.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var In=10;function En(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Tn(t){return t.b?1:t.a?t.a.size:0}function _n(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function On(t,e){t.a?t.a.add(e):t.b=e}function Sn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Dn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=E(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return B(t.c)}function Nn(){}function An(){this.a=new Nn}function jn(t,e,n){var r=n||"";try{ze(t,function(t,n){var i=t;A(t)&&(i=zt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(jd){throw e.push(r+"type="+encodeURIComponent("_badmap")),jd}}function kn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}wn.prototype.cancel=function(){var t,e;if(this.c=Dn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=E(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Nn.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},Nn.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var Cn=S.JSON.parse;function xn(t){Bt.call(this),this.headers=new Qe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Rn,this.D=this.F=!1}M(xn,Bt);var Rn="",Pn=/^https?$/i,Ln=["POST","PUT"];function Mn(t){return"content-type"==t.toLowerCase()}function Fn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,qn(t),Vn(t)}function qn(t){t.u||(t.u=!0,Kt(t,"complete"),Kt(t,"error"))}function Un(t){if(t.b&&void 0!==O&&(!t.s[1]||4!=Kn(t)||2!=t.W()))if(t.l&&4==Kn(t))ie(t.za,0,t);else if(Kt(t,"readystatechange"),4==Kn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(Xe)[1]||null;if(!o&&S.self&&S.self.location){var s=S.self.location.protocol;o=s.substr(0,s.length-1)}i=!Pn.test(o?o.toLowerCase():"")}e=i}if(e)Kt(t,"complete"),Kt(t,"success");else{t.h=6;try{var a=2<Kn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",qn(t)}}finally{Vn(t)}}}function Vn(t,e){if(t.a){Bn(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||Kt(t,"ready");try{n.onreadystatechange=r}catch(jd){}}}function Bn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function Kn(t){return t.a?t.a.readyState:0}function Gn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Y(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):nn(t,e,n))}function zn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Qn(t){this.pa=0,this.g=[],this.c=new le,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=zn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=zn("baseRetryDelayMs",5e3,t),this.Ra=zn("retryDelaySeedMs",1e4,t),this.Ma=zn("forwardChannelMaxRetries",2,t),this.ma=zn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new wn(t&&t.concurrentRequestLimit),this.ka=new An,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Hn(t){if(Xn(t),3==t.v){var e=t.R++,n=Je(t.B);nn(n,"SID",t.J),nn(n,"RID",e),nn(n,"TYPE","terminate"),Zn(t,n),(e=new ke(t,t.c,e,void 0)).H=2,e.i=rn(Je(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.i.toString(),"")),!n&&S.Image&&((new Image).src=e.i,n=!0),n||(e.a=lr(e.g,null),e.a.ba(e.i)),e.u=L(),qe(e)}cr(t)}function Wn(t){t.a&&(rr(t),t.a.cancel(),t.a=null)}function Xn(t){Wn(t),t.j&&(S.clearTimeout(t.j),t.j=null),or(t),t.b.cancel(),t.h&&("number"==typeof t.h&&S.clearTimeout(t.h),t.h=null)}function Yn(t,e){t.g.push(new bn(t.Oa++,e)),3==t.v&&Jn(t)}function Jn(t){En(t.b)||t.h||(t.h=!0,$t(t.Ba,t),t.u=0)}function $n(t,e){var n;n=e?e.f:t.R++;var r=Je(t.B);nn(r,"SID",t.J),nn(r,"RID",n),nn(r,"AID",t.P),Zn(t,r),t.i&&t.l&&Gn(r,t.i,t.l),n=new ke(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=tr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),On(t.b,n),Pe(n,r,e)}function Zn(t,e){t.f&&ze({},function(t,n){nn(e,n,t)})}function tr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?R(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{jn(h,s,"req"+c+"_")}catch(Kr){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function er(t){t.a||t.j||(t.T=1,$t(t.Aa,t),t.o=0)}function nr(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=Ie(R(t.Aa,t),ar(t,t.o)),t.o++,0))}function rr(t){null!=t.s&&(S.clearTimeout(t.s),t.s=null)}function ir(t){t.a=new ke(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Je(t.la);nn(e,"RID","rpc"),nn(e,"SID",t.J),nn(e,"CI",t.H?"0":"1"),nn(e,"AID",t.P),Zn(t,e),nn(e,"TYPE","xmlhttp"),t.i&&t.l&&Gn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=rn(Je(e)),n.j=null,n.I=!0,Le(n,t)}function or(t){null!=t.m&&(S.clearTimeout(t.m),t.m=null)}function sr(t,e){var n=null;if(t.a==e){or(t),rr(t),t.a=null;var r=2}else{if(!_n(t.b,e))return;n=e.s,Sn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=L()-e.u;var i=t.u;Kt(r=ye(),new we(r,n,e,i)),Jn(t)}else er(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Tn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=Ie(R(t.Ba,t,e),ar(t,t.u)),t.u++,0)))}(t,e)||2==r&&nr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ur(t,5);break;case 4:ur(t,10);break;case 3:ur(t,6);break;default:ur(t,2)}}function ar(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function ur(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=R(t.Ya,t);n||(n=new Ye("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||$e(n,"https"),rn(n)),function(t,e){var n=new le;if(S.Image){var r=new Image;r.onload=P(kn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=P(kn,n,r,"TestLoadImage: error",!1,e),r.onabort=P(kn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=P(kn,n,r,"TestLoadImage: timeout",!1,e),S.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else be(2);t.v=0,t.f&&t.f.ra(e),cr(t),Xn(t)}function cr(t){t.v=0,t.I=-1,t.f&&(0==Dn(t.b).length&&0==t.g.length||(t.b.c.length=0,B(t.g),t.g.length=0),t.f.qa())}function hr(t,e,n){var r=function(t){return t instanceof Ye?Je(t):new Ye(t,void 0)}(n);if(""!=r.c)e&&Ze(r,e+"."+r.c),tn(r,r.h);else{var i=S.location;r=function(t,e,n,r){var i=new Ye(null,void 0);return t&&$e(i,t),e&&Ze(i,e),n&&tn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&Y(t.V,function(t,e){nn(r,e,t)}),n=t.na,(e=t.A)&&n&&nn(r,e,n),nn(r,"VER",t.ha),Zn(t,r),r}function lr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new xn(t.Na)).F=t.C,e}function fr(){}function dr(){if(it&&!(10<=Number(yt)))throw Error("Environmental error: no available transport.")}function pr(t,e){Bt.call(this),this.a=new Qn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new gr(this)}function yr(t){Ne.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function vr(){Ae.call(this),this.status=1}function gr(t){this.a=t}(T=xn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:Se),this.a.onreadystatechange=R(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void Fn(this,o)}t=n||"";var i=new Qe(this.headers);r&&ze(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Mn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=S.FormData&&t instanceof S.FormData,!(0<=q(Ln,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Bn(this),0<this.o&&((this.D=function(t){return it&&pt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=R(this.xa,this)):this.m=ie(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){Fn(this,o)}},T.xa=function(){void 0!==O&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Kt(this,"timeout"),this.abort(8))},T.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Kt(this,"complete"),Kt(this,"abort"),Vn(this))},T.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Vn(this,!0)),xn.X.G.call(this)},T.za=function(){this.j||(this.A||this.l||this.g?Un(this):this.Ua())},T.Ua=function(){Un(this)},T.W=function(){try{return 2<Kn(this)?this.a.status:-1}catch(nt){return-1}},T.$=function(){try{return this.a?this.a.responseText:""}catch(nt){return""}},T.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Cn(e)}},T.ua=function(){return this.h},T.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(T=Qn.prototype).ha=8,T.v=1,T.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ke(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Z(r=J(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=tr(this,n,e),nn(i=Je(this.B),"RID",t),nn(i,"CVER",22),this.A&&nn(i,"X-HTTP-Session-Id",this.A),Zn(this,i),this.i&&r&&Gn(i,this.i,r),On(this.b,n),this.Ia&&nn(i,"TYPE","init"),this.da?(nn(i,"$req",e),nn(i,"SID","null"),n.U=!0,Pe(n,i,null)):Pe(n,i,e),this.v=2}}else 3==this.v&&(t?$n(this,t):0==this.g.length||En(this.b)||$n(this))},T.Aa=function(){if(this.j=null,ir(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=Ie(R(this.Ta,this),t)}},T.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,be(10),Wn(this),ir(this))},T.Sa=function(){null!=this.m&&(this.m=null,Wn(this),nr(this),be(19))},T.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),be(2)):(this.c.info("Failed to ping google.com"),be(1))},(T=fr.prototype).ta=function(){},T.sa=function(){},T.ra=function(){},T.qa=function(){},T.Ja=function(){},dr.prototype.a=function(t,e){return new pr(t,e)},M(pr,Bt),pr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;be(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=hr(t,null,t.fa),Jn(t)},pr.prototype.close=function(){Hn(this.a)},pr.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Yn(this.a,e)}else this.l?((e={}).__data__=zt(t),Yn(this.a,e)):Yn(this.a,t)},pr.prototype.G=function(){this.a.f=null,delete this.f,Hn(this.a),delete this.a,pr.X.G.call(this)},M(yr,Ne),M(vr,Ae),M(gr,fr),gr.prototype.ta=function(){Kt(this.a,"a")},gr.prototype.sa=function(t){Kt(this.a,new yr(t))},gr.prototype.ra=function(t){Kt(this.a,new vr(t))},gr.prototype.qa=function(){Kt(this.a,"b")},dr.prototype.createWebChannel=dr.prototype.a,pr.prototype.send=pr.prototype.h,pr.prototype.open=pr.prototype.g,pr.prototype.close=pr.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Te.COMPLETE="complete",Oe.EventType=De,De.OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",Bt.prototype.listen=Bt.prototype.va,xn.prototype.listenOnce=xn.prototype.wa,xn.prototype.getLastError=xn.prototype.Qa,xn.prototype.getLastErrorCode=xn.prototype.ua,xn.prototype.getStatus=xn.prototype.W,xn.prototype.getResponseJson=xn.prototype.Pa,xn.prototype.getResponseText=xn.prototype.$,xn.prototype.send=xn.prototype.ba;var mr=Ee,br=Te,wr=de,Ir=Oe,Er=xn,Tr=n("mrSG"),_r=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();_r.o=-1;var Or={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Sr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(Tr.c)(e,t),e}(Error),Dr=new w.b("@firebase/firestore");function Nr(){return Dr.logLevel}function Ar(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Dr.logLevel<=w.a.DEBUG){var r=e.map(Cr);Dr.debug.apply(Dr,Object(Tr.f)(["Firestore (8.4.0): "+t],r))}}function jr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Dr.logLevel<=w.a.ERROR){var r=e.map(Cr);Dr.error.apply(Dr,Object(Tr.f)(["Firestore (8.4.0): "+t],r))}}function kr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Dr.logLevel<=w.a.WARN){var r=e.map(Cr);Dr.warn.apply(Dr,Object(Tr.f)(["Firestore (8.4.0): "+t],r))}}function Cr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(jd){return t}}function xr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.4.0) INTERNAL ASSERTION FAILED: "+t;throw jr(e),new Error(e)}function Rr(t,e){t||xr()}function Pr(t,e){return t}function Lr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Mr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Lr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Fr(t,e){return t<e?-1:t>e?1:0}function qr(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function Ur(t){return t+"\0"}var Vr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Sr(Or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Sr(Or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Sr(Or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Sr(Or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Fr(this.nanoseconds,t.nanoseconds):Fr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Br=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Vr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Kr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Gr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function zr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Qr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&xr(),void 0===n?n=t.length-e:n>t.length-e&&xr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Hr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Tr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Sr(Or.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Qr),Wr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Xr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Tr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Wr.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Sr(Or.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Sr(Or.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Sr(Or.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Sr(Or.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Qr),Yr=function(){function t(t){this.fields=t,t.sort(Xr.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return qr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),Jr=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Fr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Jr.EMPTY_BYTE_STRING=new Jr("");var $r=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zr(t){if(Rr(!!t),"string"==typeof t){var e=0,n=$r.exec(t);if(Rr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ti(t.seconds),nanos:ti(t.nanos)}}function ti(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ei(t){return"string"==typeof t?Jr.fromBase64String(t):Jr.fromUint8Array(t)}function ni(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ri(t){var e=t.mapValue.fields.__previous_value__;return ni(e)?ri(e):e}function ii(t){var e=Zr(t.mapValue.fields.__local_write_time__.timestampValue);return new Vr(e.seconds,e.nanos)}function oi(t){return null==t}function si(t){return 0===t&&1/t==-1/0}function ai(t){return"number"==typeof t&&Number.isInteger(t)&&!si(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var ui=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Hr.fromString(e))},t.fromName=function(e){return new t(Hr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Hr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Hr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Hr(e.slice()))},t}();function ci(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ni(t)?4:10:xr()}function hi(t,e){var n=ci(t);if(n!==ci(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ii(t).isEqual(ii(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Zr(t.timestampValue),r=Zr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ei(t.bytesValue).isEqual(ei(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ti(t.geoPointValue.latitude)===ti(e.geoPointValue.latitude)&&ti(t.geoPointValue.longitude)===ti(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ti(t.integerValue)===ti(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ti(t.doubleValue),r=ti(e.doubleValue);return n===r?si(n)===si(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return qr(t.arrayValue.values||[],e.arrayValue.values||[],hi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Kr(n)!==Kr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!hi(n[i],r[i])))return!1;return!0}(t,e);default:return xr()}}function li(t,e){return void 0!==(t.values||[]).find(function(t){return hi(t,e)})}function fi(t,e){var n=ci(t),r=ci(e);if(n!==r)return Fr(n,r);switch(n){case 0:return 0;case 1:return Fr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=ti(t.integerValue||t.doubleValue),r=ti(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return di(t.timestampValue,e.timestampValue);case 4:return di(ii(t),ii(e));case 5:return Fr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ei(t),r=ei(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Fr(n[i],r[i]);if(0!==o)return o}return Fr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Fr(ti(t.latitude),ti(e.latitude));return 0!==n?n:Fr(ti(t.longitude),ti(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=fi(n[i],r[i]);if(o)return o}return Fr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Fr(r[s],o[s]);if(0!==a)return a;var u=fi(n[r[s]],i[o[s]]);if(0!==u)return u}return Fr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw xr()}}function di(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Fr(t,e);var n=Zr(t),r=Zr(e),i=Fr(n.seconds,r.seconds);return 0!==i?i:Fr(n.nanos,r.nanos)}function pi(t){return yi(t)}function yi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Zr(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ei(t.bytesValue).toBase64():"referenceValue"in t?ui.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=yi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+yi(t.fields[o])}return e+"}"}(t.mapValue):xr();var e}function vi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function gi(t){return!!t&&"integerValue"in t}function mi(t){return!!t&&"arrayValue"in t}function bi(t){return!!t&&"nullValue"in t}function wi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ii(t){return!!t&&"mapValue"in t}var Ei=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(Xr.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach(function(t,n){t?e.set(n,t):e.delete(n)})},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return hi(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===ci(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=Ii(o)?Object.assign({},o.mapValue.fields):{};return n.forEach(function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)}),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(Xr.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!Ii(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function Ti(t){var e=[];return Gr(t.fields||{},function(t,n){var r=new Xr([t]);if(Ii(n)){var i=Ti(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new Yr(e)}var _i=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Br.min(),Ei.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ei.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ei.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ei.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ei.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Oi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Si(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Oi(t,e,n,r,i,o,s)}function Di(t){var e=Pr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+pi(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),oi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Ui(e.startAt)),e.endAt&&(n+="|ub:",n+=Ui(e.endAt)),e.h=n}return e.h}function Ni(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Bi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!hi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Gi(t.startAt,e.startAt)&&Gi(t.endAt,e.endAt)}function Ai(t){return ui.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var ji=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(Tr.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new ki(t,n,r):"array-contains"===n?new Pi(t,r):"in"===n?new Li(t,r):"not-in"===n?new Mi(t,r):"array-contains-any"===n?new Fi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Ci(t,n):new xi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(fi(e,this.value)):null!==e&&ci(this.value)===ci(e)&&this.m(fi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return xr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),ki=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=ui.fromName(r.referenceValue),i}return Object(Tr.c)(e,t),e.prototype.matches=function(t){var e=ui.comparator(t.key,this.key);return this.m(e)},e}(ji),Ci=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Ri(0,n),r}return Object(Tr.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(ji),xi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Ri(0,n),r}return Object(Tr.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(ji);function Ri(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return ui.fromName(t.referenceValue)})}var Pi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(Tr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return mi(e)&&li(e.arrayValue,this.value)},e}(ji),Li=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(Tr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&li(this.value.arrayValue,e)},e}(ji),Mi=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(Tr.c)(e,t),e.prototype.matches=function(t){if(li(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!li(this.value.arrayValue,e)},e}(ji),Fi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(Tr.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!mi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return li(e.value.arrayValue,t)})},e}(ji),qi=function(t,e){this.position=t,this.before=e};function Ui(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return pi(t)}).join(",")}var Vi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Bi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ki(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?ui.comparator(ui.fromName(s.referenceValue),n.key):fi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Gi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!hi(t.position[n],e.position[n]))return!1;return!0}var zi=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Qi(t,e,n,r,i,o,s,a){return new zi(t,e,n,r,i,o,s,a)}function Hi(t){return new zi(t)}function Wi(t){return!oi(t.limit)&&"F"===t.limitType}function Xi(t){return!oi(t.limit)&&"L"===t.limitType}function Yi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Ji(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function $i(t){return null!==t.collectionGroup}function Zi(t){var e=Pr(t);if(null===e.p){e.p=[];var n=Ji(e),r=Yi(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Vi(n)),e.p.push(new Vi(Xr.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Vi(Xr.keyField(),u))}}}return e.p}function to(t){var e=Pr(t);if(!e.T)if("F"===e.limitType)e.T=Si(e.path,e.collectionGroup,Zi(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Zi(e);r<i.length;r++){var o=i[r];n.push(new Vi(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new qi(e.endAt.position,!e.endAt.before):null,a=e.startAt?new qi(e.startAt.position,!e.startAt.before):null;e.T=Si(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function eo(t,e,n){return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function no(t,e){return Ni(to(t),to(e))&&t.limitType===e.limitType}function ro(t){return Di(to(t))+"|lt:"+t.limitType}function io(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+pi(e.value);var e}).join(", ")+"]"),oi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Ui(t.startAt)),t.endAt&&(e+=", endAt: "+Ui(t.endAt)),"Target("+e+")"}(to(t))+"; limitType="+t.limitType+")"}function oo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ui.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ki(t.startAt,Zi(t),e)||t.endAt&&Ki(t.endAt,Zi(t),e))}(t,e)}function so(t){return function(e,n){for(var r=!1,i=0,o=Zi(t);i<o.length;i++){var s=o[i],a=ao(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function ao(t,e,n){var r=t.field.isKeyField()?ui.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?fi(r,i):xr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return xr()}}function uo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:si(e)?"-0":e}}function co(t){return{integerValue:""+t}}function ho(t,e){return ai(e)?co(e):uo(t,e)}var lo=function(){this._=void 0};function fo(t,e,n){return t instanceof vo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof go?mo(t,e):t instanceof bo?wo(t,e):function(t,e){var n=yo(t,e),r=Eo(n)+Eo(t.A);return gi(n)&&gi(t.A)?co(r):uo(t.R,r)}(t,e)}function po(t,e,n){return t instanceof go?mo(t,e):t instanceof bo?wo(t,e):n}function yo(t,e){return t instanceof Io?gi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var vo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Tr.c)(e,t),e}(lo),go=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Tr.c)(e,t),e}(lo);function mo(t,e){for(var n=To(e),r=function(t){n.some(function(e){return hi(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var bo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Tr.c)(e,t),e}(lo);function wo(t,e){for(var n=To(e),r=function(t){n=n.filter(function(e){return!hi(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Io=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(Tr.c)(e,t),e}(lo);function Eo(t){return ti(t.integerValue||t.doubleValue)}function To(t){return mi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var _o=function(t,e){this.field=t,this.transform=e},Oo=function(t,e){this.version=t,this.transformResults=e},So=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Do(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var No=function(){};function Ao(t,e,n){t instanceof Ro?function(t,e,n){var r=t.value.clone(),i=Mo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Po?function(t,e,n){if(Do(t.precondition,e)){var r=Mo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Lo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function jo(t,e,n){t instanceof Ro?function(t,e,n){if(Do(t.precondition,e)){var r=t.value.clone(),i=Fo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(xo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Po?function(t,e,n){if(Do(t.precondition,e)){var r=Fo(t.fieldTransforms,n,e),i=e.data;i.setAll(Lo(t)),i.setAll(r),e.convertToFoundDocument(xo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Do(t.precondition,e)&&e.convertToNoDocument(Br.min())}(t,e)}function ko(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=yo(o.transform,s||null);null!=a&&(null==n&&(n=Ei.empty()),n.set(o.field,a))}return n||null}function Co(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&qr(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof go&&e instanceof go||t instanceof bo&&e instanceof bo?qr(t.elements,e.elements,hi):t instanceof Io&&e instanceof Io?hi(t.A,e.A):t instanceof vo&&e instanceof vo}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function xo(t){return t.isFoundDocument()?t.version:Br.min()}var Ro=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(Tr.c)(e,t),e}(No),Po=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(Tr.c)(e,t),e}(No);function Lo(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function Mo(t,e,n){var r=new Map;Rr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,po(s,a,n[i]))}return r}function Fo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,fo(a,u,e))}return r}var qo,Uo,Vo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(Tr.c)(e,t),e}(No),Bo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(Tr.c)(e,t),e}(No),Ko=function(t){this.count=t};function Go(t){switch(t){case Or.OK:return xr();case Or.CANCELLED:case Or.UNKNOWN:case Or.DEADLINE_EXCEEDED:case Or.RESOURCE_EXHAUSTED:case Or.INTERNAL:case Or.UNAVAILABLE:case Or.UNAUTHENTICATED:return!1;case Or.INVALID_ARGUMENT:case Or.NOT_FOUND:case Or.ALREADY_EXISTS:case Or.PERMISSION_DENIED:case Or.FAILED_PRECONDITION:case Or.ABORTED:case Or.OUT_OF_RANGE:case Or.UNIMPLEMENTED:case Or.DATA_LOSS:return!0;default:return xr()}}function zo(t){if(void 0===t)return jr("GRPC error has no .code"),Or.UNKNOWN;switch(t){case qo.OK:return Or.OK;case qo.CANCELLED:return Or.CANCELLED;case qo.UNKNOWN:return Or.UNKNOWN;case qo.DEADLINE_EXCEEDED:return Or.DEADLINE_EXCEEDED;case qo.RESOURCE_EXHAUSTED:return Or.RESOURCE_EXHAUSTED;case qo.INTERNAL:return Or.INTERNAL;case qo.UNAVAILABLE:return Or.UNAVAILABLE;case qo.UNAUTHENTICATED:return Or.UNAUTHENTICATED;case qo.INVALID_ARGUMENT:return Or.INVALID_ARGUMENT;case qo.NOT_FOUND:return Or.NOT_FOUND;case qo.ALREADY_EXISTS:return Or.ALREADY_EXISTS;case qo.PERMISSION_DENIED:return Or.PERMISSION_DENIED;case qo.FAILED_PRECONDITION:return Or.FAILED_PRECONDITION;case qo.ABORTED:return Or.ABORTED;case qo.OUT_OF_RANGE:return Or.OUT_OF_RANGE;case qo.UNIMPLEMENTED:return Or.UNIMPLEMENTED;case qo.DATA_LOSS:return Or.DATA_LOSS;default:return xr()}}(Uo=qo||(qo={}))[Uo.OK=0]="OK",Uo[Uo.CANCELLED=1]="CANCELLED",Uo[Uo.UNKNOWN=2]="UNKNOWN",Uo[Uo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Uo[Uo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Uo[Uo.NOT_FOUND=5]="NOT_FOUND",Uo[Uo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Uo[Uo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Uo[Uo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Uo[Uo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Uo[Uo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Uo[Uo.ABORTED=10]="ABORTED",Uo[Uo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Uo[Uo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Uo[Uo.INTERNAL=13]="INTERNAL",Uo[Uo.UNAVAILABLE=14]="UNAVAILABLE",Uo[Uo.DATA_LOSS=15]="DATA_LOSS";var Qo=function(){function t(t,e){this.comparator=t,this.root=e||Wo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Wo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ho(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ho(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ho(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ho(this.root,t,this.comparator,!0)},t}(),Ho=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Wo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw xr();if(this.right.isRed())throw xr();var t=this.left.check();if(t!==this.right.check())throw xr();return t+(this.isRed()?0:1)},t}();Wo.EMPTY=null,Wo.RED=!0,Wo.BLACK=!1,Wo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw xr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Wo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Xo=function(){function t(t){this.comparator=t,this.data=new Qo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Yo(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Yo(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Yo=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Jo=new Qo(ui.comparator);function $o(){return Jo}var Zo=new Qo(ui.comparator);function ts(){return Zo}var es=new Qo(ui.comparator);function ns(){return es}var rs=new Xo(ui.comparator);function is(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=rs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var os=new Xo(Fr);function ss(){return os}var as=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,us.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Br.min(),r,ss(),$o(),is())},t}(),us=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Jr.EMPTY_BYTE_STRING,n,is(),is(),is())},t}(),cs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},hs=function(t,e){this.targetId=t,this.V=e},ls=function(t,e,n,r){void 0===n&&(n=Jr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},fs=function(){function t(){this.S=0,this.D=ys(),this.C=Jr.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=is(),e=is(),n=is();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:xr()}}),new us(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=ys()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),ds=function(){function t(t){this.W=t,this.G=new Map,this.H=$o(),this.J=ps(),this.Y=new Xo(Fr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:xr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Ai(i))if(0===n){var o=new ui(i.path);this.tt(e,o,_i.newNoDocument(o,Br.min()))}else Rr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Ai(o.target)){var s=new ui(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,_i.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}});var r=is();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new as(t,n,this.Y,this.H,r);return this.H=$o(),this.J=ps(),this.Y=new Xo(Fr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new fs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Xo(Fr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Ar("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new fs),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function ps(){return new Qo(ui.comparator)}function ys(){return new Qo(ui.comparator)}var vs={asc:"ASCENDING",desc:"DESCENDING"},gs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ms=function(t,e){this.databaseId=t,this.I=e};function bs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ws(t,e){return t.I?e.toBase64():e.toUint8Array()}function Is(t,e){return bs(t,e.toTimestamp())}function Es(t){return Rr(!!t),Br.fromTimestamp(function(t){var e=Zr(t);return new Vr(e.seconds,e.nanos)}(t))}function Ts(t,e){return function(t){return new Hr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function _s(t){var e=Hr.fromString(t);return Rr(Ws(e)),e}function Os(t,e){return Ts(t.databaseId,e.path)}function Ss(t,e){var n=_s(e);if(n.get(1)!==t.databaseId.projectId)throw new Sr(Or.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Sr(Or.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ui(js(n))}function Ds(t,e){return Ts(t.databaseId,e)}function Ns(t){var e=_s(t);return 4===e.length?Hr.emptyPath():js(e)}function As(t){return new Hr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function js(t){return Rr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function ks(t,e,n){return{name:Os(t,e),fields:n.toProto().mapValue.fields}}function Cs(t,e,n){var r=Ss(t,e.name),i=Es(e.updateTime),o=new Ei({mapValue:{fields:e.fields}}),s=_i.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function xs(t,e){var n;if(e instanceof Ro)n={update:ks(t,e.key,e.value)};else if(e instanceof Vo)n={delete:Os(t,e.key)};else if(e instanceof Po)n={update:ks(t,e.key,e.data),updateMask:Hs(e.fieldMask)};else{if(!(e instanceof Bo))return xr();n={verify:Os(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof vo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof go)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof bo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Io)return{fieldPath:e.field.canonicalString(),increment:n.A};throw xr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Is(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:xr()}(t,e.precondition)),n}function Rs(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?So.updateTime(Es(t.updateTime)):void 0!==t.exists?So.exists(t.exists):So.none()}(e.currentDocument):So.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Rr("REQUEST_TIME"===e.setToServerValue),n=new vo):"appendMissingElements"in e?n=new go(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new bo(e.removeAllFromArray.values||[]):"increment"in e?n=new Io(t,e.increment):xr();var r=Xr.fromServerFormat(e.fieldPath);return new _o(r,n)}(t,e)}):[];if(e.update){var i=Ss(t,e.update.name),o=new Ei({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new Yr((t.fieldPaths||[]).map(function(t){return Xr.fromServerFormat(t)}))}(e.updateMask);return new Po(i,o,s,n,r)}return new Ro(i,o,n,r)}if(e.delete){var a=Ss(t,e.delete);return new Vo(a,n)}if(e.verify){var u=Ss(t,e.verify);return new Bo(u,n)}return xr()}function Ps(t,e){return{documents:[Ds(t,e.path)]}}function Ls(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ds(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ds(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(wi(t.value))return{unaryFilter:{field:Ks(t.field),op:"IS_NAN"}};if(bi(t.value))return{unaryFilter:{field:Ks(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(wi(t.value))return{unaryFilter:{field:Ks(t.field),op:"IS_NOT_NAN"}};if(bi(t.value))return{unaryFilter:{field:Ks(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ks(t.field),op:Bs(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Ks(t.field),direction:Vs(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||oi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=qs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=qs(e.endAt)),n}function Ms(t){var e=Ns(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Rr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Fs(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new Vi(Gs(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return oi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Us(n.startAt));var h=null;return n.endAt&&(h=Us(n.endAt)),Qi(e,i,a,s,u,"F",c,h)}function Fs(t){return t?void 0!==t.unaryFilter?[Qs(t)]:void 0!==t.fieldFilter?[zs(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Fs(t)}).reduce(function(t,e){return t.concat(e)}):xr():[]}function qs(t){return{before:t.before,values:t.position}}function Us(t){return new qi(t.values||[],!!t.before)}function Vs(t){return vs[t]}function Bs(t){return gs[t]}function Ks(t){return{fieldPath:t.canonicalString()}}function Gs(t){return Xr.fromServerFormat(t.fieldPath)}function zs(t){return ji.create(Gs(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return xr()}}(t.fieldFilter.op),t.fieldFilter.value)}function Qs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Gs(t.unaryFilter.field);return ji.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Gs(t.unaryFilter.field);return ji.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Gs(t.unaryFilter.field);return ji.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Gs(t.unaryFilter.field);return ji.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return xr()}}function Hs(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function Ws(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Xs(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Js(e)),e=Ys(t.get(n),e);return Js(e)}function Ys(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Js(t){return t+"\x01\x01"}function $s(t){var e=t.length;if(Rr(e>=2),2===e)return Rr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Hr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&xr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:xr()}o=s+2}return new Hr(r)}var Zs=function(t,e){this.seconds=t,this.nanoseconds=e},ta=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};ta.store="owner",ta.key="owner";var ea=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ea.store="mutationQueues",ea.keyPath="userId";var na=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};na.store="mutations",na.keyPath="batchId",na.userMutationsIndex="userMutationsIndex",na.userMutationsKeyPath=["userId","batchId"];var ra=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Xs(e)]},t.key=function(t,e,n){return[t,Xs(e),n]},t}();ra.store="documentMutations",ra.PLACEHOLDER=new ra;var ia=function(t,e){this.path=t,this.readTime=e},oa=function(t,e){this.path=t,this.version=e},sa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};sa.store="remoteDocuments",sa.readTimeIndex="readTimeIndex",sa.readTimeIndexPath="readTime",sa.collectionReadTimeIndex="collectionReadTimeIndex",sa.collectionReadTimeIndexPath=["parentPath","readTime"];var aa=function(t){this.byteSize=t};aa.store="remoteDocumentGlobal",aa.key="remoteDocumentGlobalKey";var ua=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ua.store="targets",ua.keyPath="targetId",ua.queryTargetsIndexName="queryTargetsIndex",ua.queryTargetsKeyPath=["canonicalId","targetId"];var ca=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ca.store="targetDocuments",ca.keyPath=["targetId","path"],ca.documentTargetsIndex="documentTargetsIndex",ca.documentTargetsKeyPath=["path","targetId"];var ha=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ha.key="targetGlobalKey",ha.store="targetGlobal";var la=function(t,e){this.collectionId=t,this.parent=e};la.store="collectionParents",la.keyPath=["collectionId","parent"];var fa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};fa.store="clientMetadata",fa.keyPath="clientId";var da=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};da.store="bundles",da.keyPath="bundleId";var pa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};pa.store="namedQueries",pa.keyPath="name";var ya=Object(Tr.f)(Object(Tr.f)([],Object(Tr.f)(Object(Tr.f)([],Object(Tr.f)(Object(Tr.f)([],Object(Tr.f)(Object(Tr.f)([],[ea.store,na.store,ra.store,sa.store,ua.store,ta.store,ha.store,ca.store]),[fa.store])),[aa.store])),[la.store])),[da.store,pa.store]),va="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ga=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),ma=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},ba=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&xr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),wa=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new ma,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Ta(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Na(e.target.error);n.ft.reject(new Ta(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Ta(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Ar("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Oa(e)},t}(),Ia=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(b.h)())&&jr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Ar("SimpleDb","Removing database:",t),Sa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(b.h)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(Tr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Tr.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Ar("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Ta(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Sr(Or.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Ta(t,n))},i.onupgradeneeded=function(t){Ar("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Ar("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(Tr.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(Tr.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(Tr.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=wa.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),ba.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Ar("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Ea=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Sa(this.Pt.delete())},t}(),Ta=function(t){function e(e,n){var r=this;return(r=t.call(this,Or.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(Tr.c)(e,t),e}(Sr);function _a(t){return"IndexedDbTransactionError"===t.name}var Oa=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Ar("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Ar("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Sa(n)},t.prototype.add=function(t){return Ar("SimpleDb","ADD",this.store.name,t,t),Sa(this.store.add(t))},t.prototype.get=function(t){var e=this;return Sa(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Ar("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Ar("SimpleDb","DELETE",this.store.name,t),Sa(this.store.delete(t))},t.prototype.count=function(){return Ar("SimpleDb","COUNT",this.store.name),Sa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Ar("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new ba(function(n,r){e.onerror=function(t){var e=Na(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new ba(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ea(i),s=e(i.primaryKey,i.value,o);if(s instanceof ba){var a=s.catch(function(t){return o.done(),ba.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return ba.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Sa(t){return new ba(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Na(t.target.error);n(e)}})}var Da=!1;function Na(t){var e=Ia._t(Object(b.h)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Sr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Da||(Da=!0,setTimeout(function(){throw r},0)),r}}return t}var Aa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(Tr.c)(e,t),e}(ga);function ja(t,e){var n=Pr(t);return Ia.It(n.Mt,e)}var ka=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Ao(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&jo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&jo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Br.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},is())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&qr(this.mutations,t.mutations,function(t,e){return Co(t,e)})&&qr(this.baseMutations,t.baseMutations,function(t,e){return Co(t,e)})},t}(),Ca=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Rr(e.mutations.length===r.length);for(var i=ns(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),xa=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Br.min()),void 0===o&&(o=Br.min()),void 0===s&&(s=Jr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ra=function(t){this.Lt=t};function Pa(t,e){if(e.document)return Cs(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ui.fromSegments(e.noDocument.path),r=Ua(e.noDocument.readTime),i=_i.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=ui.fromSegments(e.unknownDocument.path);return r=Ua(e.unknownDocument.version),_i.newUnknownDocument(o,r)}return xr()}function La(t,e,n){var r=Ma(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Os(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:bs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new sa(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=qa(e.version);return s=e.hasCommittedMutations,new sa(null,new ia(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=qa(e.version);return new sa(new oa(c,h),null,null,!0,r,i)}return xr()}function Ma(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Fa(t){var e=new Vr(t[0],t[1]);return Br.fromTimestamp(e)}function qa(t){var e=t.toTimestamp();return new Zs(e.seconds,e.nanoseconds)}function Ua(t){var e=new Vr(t.seconds,t.nanoseconds);return Br.fromTimestamp(e)}function Va(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Rs(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Rs(t.Lt,e)}),o=Vr.fromMillis(e.localWriteTimeMs);return new ka(e.batchId,o,n,i)}function Ba(t){var e,n,r=Ua(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ua(t.lastLimboFreeSnapshotVersion):Br.min();return void 0!==t.query.documents?(Rr(1===(n=t.query).documents.length),e=to(Hi(Ns(n.documents[0])))):e=function(t){return to(Ms(t))}(t.query),new xa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Jr.fromBase64String(t.resumeToken))}function Ka(t,e){var n,r=qa(e.snapshotVersion),i=qa(e.lastLimboFreeSnapshotVersion);n=Ai(e.target)?Ps(t.Lt,e.target):Ls(t.Lt,e.target);var o=e.resumeToken.toBase64();return new ua(e.targetId,Di(e.target),r,o,e.sequenceNumber,i,n)}function Ga(t){var e=Ms({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?eo(e,e.limit,"L"):e}var za=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Qa(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Ua(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return Qa(t).put({bundleId:(n=e).id,createTime:qa(Es(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Ha(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Ga(e.bundledQuery),readTime:Ua(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return Ha(t).put(function(t){return{name:t.name,readTime:qa(Es(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Qa(t){return ja(t,da.store)}function Ha(t){return ja(t,pa.store)}var Wa=function(){function t(){this.Bt=new Xa}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),ba.resolve()},t.prototype.getCollectionParents=function(t,e){return ba.resolve(this.Bt.getEntries(e))},t}(),Xa=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Xo(Hr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Xo(Hr.comparator)).toArray()},t}(),Ya=function(){function t(){this.qt=new Xa}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:Xs(i)};return Ja(t).put(o)}return ba.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Ur(e),""],!1,!0);return Ja(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push($s(o.parent))}return n})},t}();function Ja(t){return ja(t,la.store)}var $a={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Za=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function tu(t,e,n){var r=t.store(na.store),i=t.store(ra.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Rr(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=ra.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return ba.waitFor(o).next(function(){return c})}function eu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw xr();e=t.noDocument}return JSON.stringify(e).length}Za.DEFAULT_COLLECTION_PERCENTILE=10,Za.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Za.DEFAULT=new Za(41943040,Za.DEFAULT_COLLECTION_PERCENTILE,Za.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Za.DISABLED=new Za(-1,0,0);var nu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Rr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return iu(t).Ot({index:na.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=ou(t),s=iu(t);return s.add({}).next(function(a){Rr("number"==typeof a);for(var u=new ka(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return xs(t.Lt,e)}),i=n.mutations.map(function(e){return xs(t.Lt,e)});return new na(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Xo(function(t,e){return Fr(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],y=ra.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,ra.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Qt[a]=u.keys()}),ba.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return iu(t).get(e).next(function(t){return t?(Rr(t.userId===n.userId),Va(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?ba.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return iu(t).Ot({index:na.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Rr(e.batchId>=r),o=Va(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return iu(t).Ot({index:na.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return iu(t).Nt(na.userMutationsIndex,n).next(function(t){return t.map(function(t){return Va(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=ra.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return ou(t).Ot({range:i},function(r,i,s){var a=r[0],u=r[2],c=$s(r[1]);if(a===n.userId&&e.path.isEqual(c))return iu(t).get(u).next(function(t){if(!t)throw xr();Rr(t.userId===n.userId),o.push(Va(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Xo(Fr),i=[];return e.forEach(function(e){var o=ra.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=ou(t).Ot({range:s},function(t,i,o){var s=t[0],a=t[2],u=$s(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),ba.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=ra.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Xo(Fr);return ou(t).Ot({range:s},function(t,e,o){var s=t[0],u=t[2],c=$s(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(iu(t).get(e).next(function(t){if(null===t)throw xr();Rr(t.userId===n.userId),r.push(Va(n.R,t))}))}),ba.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return tu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),ba.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return ba.resolve();var r=IDBKeyRange.lowerBound(ra.prefixForUser(e.userId)),i=[];return ou(t).Ot({range:r},function(t,n,r){if(t[0]===e.userId){var o=$s(t[1]);i.push(o)}else r.done()}).next(function(){Rr(0===i.length)})})},t.prototype.containsKey=function(t,e){return ru(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return su(t).get(this.userId).next(function(t){return t||new ea(e.userId,-1,"")})},t}();function ru(t,e,n){var r=ra.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return ou(t).Ot({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function iu(t){return ja(t,na.store)}function ou(t){return ja(t,ra.store)}function su(t){return ja(t,ea.store)}var au=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),uu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new au(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Br.fromTimestamp(new Vr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return cu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Rr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return cu(t).Ot(function(s,a){var u=Ba(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return ba.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return cu(t).Ot(function(t,n){var r=Ba(n);e(r)})},t.prototype.Xt=function(t){return hu(t).get(ha.key).next(function(t){return Rr(null!==t),t})},t.prototype.Zt=function(t,e){return hu(t).put(ha.key,e)},t.prototype.te=function(t,e){return cu(t).put(Ka(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Di(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return cu(t).Ot({range:r,index:ua.queryTargetsIndexName},function(t,n,r){var o=Ba(n);Ni(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=lu(t);return e.forEach(function(e){var s=Xs(e.path);i.push(o.put(new ca(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),ba.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=lu(t);return ba.forEach(e,function(e){var o=Xs(e.path);return ba.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=lu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=lu(t),i=is();return r.Ot({range:n,kt:!0},function(t,e,n){var r=$s(t[1]),o=new ui(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Xs(e.path),r=IDBKeyRange.bound([n],[Ur(n)],!1,!0),i=0;return lu(t).Ot({index:ca.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return cu(t).get(e).next(function(t){return t?Ba(t):null})},t}();function cu(t){return ja(t,ua.store)}function hu(t){return ja(t,ha.store)}function lu(t){return ja(t,ca.store)}function fu(t){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(e){if(t.code!==Or.FAILED_PRECONDITION||t.message!==va)throw t;return Ar("LocalStore","Unexpectedly lost primary lease"),[2]})})}function du(t,e){var n=t[1],r=e[1],i=Fr(t[0],e[0]);return 0===i?Fr(n,r):i}var pu=function(){function t(t){this.ne=t,this.buffer=new Xo(du),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();du(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),yu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Ar("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(Tr.b)(e,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return _a(e=n.sent())?(Ar("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,fu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),vu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ba.resolve(_r.o);var r=new pu(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Ar("LruGarbageCollector","Garbage collection skipped; disabled"),ba.resolve($a)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Ar("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),$a):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Ar("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Nr()<=w.a.DEBUG&&Ar("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),ba.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),gu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new vu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return mu(t,n)},t.prototype.removeReference=function(t,e,n){return mu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return mu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return su(t).$t(function(r){return ru(t,r,e).next(function(t){return t&&(n=!0),ba.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),lu(t).delete([0,Xs(s.path)])})});i.push(u)}}).next(function(){return ba.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return mu(t,e)},t.prototype.we=function(t,e){var n,r=lu(t),i=_r.o;return r.Ot({index:ca.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==_r.o&&e(new ui($s(n)),i),i=s,n=o):i=_r.o}).next(function(){i!==_r.o&&e(new ui($s(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function mu(t,e){return lu(t).put(function(t,e){return new ca(0,Xs(t.path),e)}(e,t.currentSequenceNumber))}var bu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Gr(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return zr(this.inner)},t}(),wu=function(){function t(){this.changes=new bu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Br.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:_i.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ba.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Iu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return _u(t).put(Ou(e),n)},t.prototype.removeEntry=function(t,e){var n=_u(t),r=Ou(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return _u(t).get(Ou(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return _u(t).get(Ou(e)).next(function(t){return{document:n.ye(e,t),size:eu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=$o();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=$o(),i=new Qo(ui.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,eu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return ba.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return _u(t).Ot({range:r},function(t,e,r){for(var s=ui.fromSegments(t);o&&ui.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=$o(),o=e.path.length+1,s={};if(n.isEqual(Br.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Ma(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=sa.collectionReadTimeIndex}return _u(t).Ot(s,function(t,n,s){if(t.length===o){var a=Pa(r.R,n);e.path.isPrefixOf(a.key.path)?oo(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Eu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Tu(t).get(aa.key).next(function(t){return Rr(!!t),t})},t.prototype.me=function(t,e){return Tu(t).put(aa.key,e)},t.prototype.ye=function(t,e){if(e){var n=Pa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Br.min()))return n}return _i.newInvalidDocument(t)},t}(),Eu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new bu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(Tr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Xo(function(t,e){return Fr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=La(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=eu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=La(e.Ie.R,_i.newNoDocument(o,Br.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),ba.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(wu);function Tu(t){return ja(t,aa.store)}function _u(t){return ja(t,sa.store)}function Ou(t){return t.path.toArray()}var Su=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Rr(n<r&&n>=0&&r<=11);var o=new wa("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(ta.store)}(t),function(t){t.createObjectStore(ea.store,{keyPath:ea.keyPath}),t.createObjectStore(na.store,{keyPath:na.keyPath,autoIncrement:!0}).createIndex(na.userMutationsIndex,na.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ra.store)}(t),Du(t),function(t){t.createObjectStore(sa.store)}(t));var s=ba.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ca.store),t.deleteObjectStore(ua.store),t.deleteObjectStore(ha.store)}(t),Du(t)),s=s.next(function(){return function(t){var e=t.store(ha.store),n=new ha(0,0,Br.min().toTimestamp(),0);return e.put(ha.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(na.store).Nt().next(function(n){t.deleteObjectStore(na.store),t.createObjectStore(na.store,{keyPath:na.keyPath,autoIncrement:!0}).createIndex(na.userMutationsIndex,na.userMutationsKeyPath,{unique:!0});var r=e.store(na.store),i=n.map(function(t){return r.put(t)});return ba.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(fa.store,{keyPath:fa.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(aa.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(sa.store);e.createIndex(sa.readTimeIndex,sa.readTimeIndexPath,{unique:!1}),e.createIndex(sa.collectionReadTimeIndex,sa.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(da.store,{keyPath:da.keyPath})}(t),function(t){t.createObjectStore(pa.store,{keyPath:pa.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(sa.store).Ot(function(t,n){e+=eu(n)}).next(function(){var n=new aa(e);return t.store(aa.store).put(aa.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(ea.store),r=t.store(na.store);return n.Nt().next(function(n){return ba.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(na.userMutationsIndex,i).next(function(r){return ba.forEach(r,function(r){Rr(r.userId===n.userId);var i=Va(e.R,r);return tu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(ca.store),n=t.store(sa.store);return t.store(ha.store).get(ha.key).next(function(t){var r=[];return n.Ot(function(n,i){var o=new Hr(n),s=function(t){return[0,Xs(t)]}(o);r.push(e.get(s).next(function(n){return n?ba.resolve():function(n){return e.put(new ca(0,Xs(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return ba.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(la.store,{keyPath:la.keyPath});var n=e.store(la.store),r=new Xa,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Xs(i)})}};return e.store(sa.store).Ot({kt:!0},function(t,e){var n=new Hr(t);return i(n.popLast())}).next(function(){return e.store(ra.store).Ot({kt:!0},function(t,e){var n=$s(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(ua.store);return n.Ot(function(t,r){var i=Ba(r),o=Ka(e.R,i);return n.put(o)})},t}();function Du(t){t.createObjectStore(ca.store,{keyPath:ca.keyPath}).createIndex(ca.documentTargetsIndex,ca.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ua.store,{keyPath:ua.keyPath}).createIndex(ua.queryTargetsIndexName,ua.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ha.store)}var Nu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Au=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Sr(Or.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new gu(this,i),this.Le=n+"main",this.R=new Ra(u),this.Be=new Ia(this.Le,11,new Su(this.R)),this.qe=new uu(this.referenceDelegate,this.R),this.Ut=new Ya,this.Ue=function(t,e){return new Iu(t,e)}(this.R,this.Ut),this.Qe=new za,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&jr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Sr(Or.FAILED_PRECONDITION,Nu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new _r(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(Tr.b)(e,void 0,void 0,function(){return Object(Tr.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(Tr.b)(e,void 0,void 0,function(){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(Tr.b)(e,void 0,void 0,function(){return Object(Tr.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return ku(e).put(new fa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(_a(e))return Ar("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Ar("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return ju(t).get(ta.key).next(function(t){return ba.resolve(e.tn(t))})},t.prototype.en=function(t){return ku(t).delete(this.clientId)},t.prototype.nn=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=ja(t,fa.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return ba.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)this.Ke.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?ba.resolve(!0):ju(t).get(ta.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Sr(Or.FAILED_PRECONDITION,Nu);return!1}}return!(!e.networkEnabled||!e.inForeground)||ku(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Ar("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t=this;return Object(Tr.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[ta.store,fa.store],function(e){var n=new Aa(e,_r.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return ku(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return nu.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Ar("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",ya,function(o){return r=new Aa(o,i.Ne?i.Ne.next():_r.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw jr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Sr(Or.FAILED_PRECONDITION,va);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return ju(t).get(ta.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Sr(Or.FAILED_PRECONDITION,Nu)})},t.prototype.Ze=function(t){var e=new ta(this.clientId,this.allowTabSynchronization,Date.now());return ju(t).put(ta.key,e)},t.yt=function(){return Ia.yt()},t.prototype.Xe=function(t){var e=this,n=ju(t);return n.get(ta.key).next(function(t){return e.tn(t)?(Ar("IndexedDbPersistence","Releasing primary lease."),n.delete(ta.key)):ba.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(jr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return Ar("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return jr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){jr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function ju(t){return ja(t,ta.store)}function ku(t){return ja(t,fa.store)}function Cu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var xu=function(t,e){this.progress=t,this.wn=e},Ru=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return ui.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):$i(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new ui(e)).next(function(t){var e=ts();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=ts();return this.Ut.getCollectionParents(t,i).next(function(s){return ba.forEach(s,function(s){var a=function(t,e){return new zi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=_i.newInvalidDocument(c),r=r.insert(c,h)),jo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){oo(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=is(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Po&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),Pu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=is(),i=is(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Lu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Br.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(Wi(e)||Xi(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Nr()<=w.a.DEBUG&&Ar("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),io(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new Xo(so(t));return e.forEach(function(e,r){oo(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Nr()<=w.a.DEBUG&&Ar("QueryEngine","Using full collection scan to execute query:",io(e)),this.Sn.getDocumentsMatchingQuery(t,e,Br.min())},t}(),Mu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Qo(Fr),this.kn=new bu(function(t){return Di(t)},Ni),this.On=Br.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Ru(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Fu(t,e,n,r){return new Mu(t,e,n,r)}function qu(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Tr.d)(this,function(s){switch(s.label){case 0:return n=Pr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Ru(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=is(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,v=p.mutations;y<v.length;y++)s=s.add(v[y].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Uu(t,e){var n=Pr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=ba.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Rr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Vu(t){var e=Pr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Bu(t,e){var n=Pr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Rr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=$o();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Ku(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(Br.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return ba.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function Ku(t,e,n,r,i){var o=is();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=$o();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Br.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Ar("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function Gu(t,e){var n=Pr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function zu(t,e){var n=Pr(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?ba.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new xa(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function Qu(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Tr.d)(this,function(a){switch(a.label){case 0:r=Pr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!_a(s=a.sent()))throw s;return Ar("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function Hu(t,e,n){var r=Pr(t),i=Br.min(),o=is();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=Pr(t),i=r.kn.get(n);return void 0!==i?ba.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,to(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Br.min(),n?o:is())}).next(function(t){return{documents:t,Bn:o}})})}function Wu(t,e){var n=Pr(t),r=Pr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function Xu(t){var e=Pr(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=Pr(t),i=$o(),o=Ma(n),s=_u(e),a=IDBKeyRange.lowerBound(o,!0);return s.Ot({index:sa.readTimeIndex,range:a},function(t,e){var n=Pa(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Fa(o)}})}(e.$n,t,e.On)}).then(function(t){var n=t.wn;return e.On=t.readTime,n})}function Yu(t){return Object(Tr.b)(this,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){return[2,(e=Pr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=_u(t),n=Br.min();return e.Ot({index:sa.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Fa(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.On=t})]})})}function Ju(t,e,n,r){return Object(Tr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(Tr.d)(this,function(p){switch(p.label){case 0:for(i=Pr(t),o=is(),s=$o(),a=ns(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.$n.newChangeBuffer({trackRemovals:!0}),[4,zu(i,function(t){return to(Hi(Hr.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Ku(t,f,s,Br.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function $u(t,e,n){return void 0===n&&(n=is()),Object(Tr.b)(this,void 0,void 0,function(){var r,i;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return[4,zu(t,to(Ga(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Pr(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Es(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(Jr.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(t,e)})})]}})})}var Zu=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return ba.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:Es(n.createTime)}),ba.resolve()},t.prototype.getNamedQuery=function(t,e){return ba.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Ga(t.bundledQuery),readTime:Es(t.readTime)}}(e)),ba.resolve()},t}(),tc=function(){function t(){this.Wn=new Xo(ec.Gn),this.zn=new Xo(ec.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new ec(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new ec(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new ui(new Hr([])),r=new ec(n,t),i=new ec(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new ui(new Hr([])),n=new ec(e,t),r=new ec(e,t+1),i=is();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new ec(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),ec=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return ui.comparator(t.key,e.key)||Fr(t.ns,e.ns)},t.Hn=function(t,e){return Fr(t.ns,e.ns)||ui.comparator(t.key,e.key)},t}(),nc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Xo(ec.Gn)}return t.prototype.checkEmpty=function(t){return ba.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new ka(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new ec(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return ba.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ba.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return ba.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return ba.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return ba.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new ec(e,0),i=new ec(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),ba.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Xo(Fr);return e.forEach(function(t){var e=new ec(t,0),i=new ec(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),ba.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;ui.isDocumentKey(i)||(i=i.child(""));var o=new ec(new ui(i),0),s=new Xo(Fr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),ba.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Rr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return ba.forEach(e.mutations,function(i){var o=new ec(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new ec(e,0),r=this.rs.firstAfterOrEqual(n);return ba.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return ba.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),rc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Qo(ui.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ba.resolve(n?n.document.clone():_i.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=$o();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():_i.newInvalidDocument(t))}),ba.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=$o(),i=new ui(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||oo(e,u)&&(r=r.insert(u.key,u.clone()))}return ba.resolve(r)},t.prototype.fs=function(t,e){return ba.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new ic(this)},t.prototype.getSize=function(t){return ba.resolve(this.size)},t}(),ic=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(Tr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),ba.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(wu),oc=function(){function t(t){this.persistence=t,this.ds=new bu(function(t){return Di(t)},Ni),this.lastRemoteSnapshotVersion=Br.min(),this.highestTargetId=0,this.ws=0,this._s=new tc,this.targetCount=0,this.ys=au.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),ba.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ba.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ba.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),ba.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),ba.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new au(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,ba.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),ba.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,ba.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),ba.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return ba.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return ba.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),ba.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),ba.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),ba.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return ba.resolve(n)},t.prototype.containsKey=function(t,e){return ba.resolve(this._s.containsKey(e))},t}(),sc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new _r(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new oc(this),this.Ut=new Wa,this.Ue=function(t,e){return new rc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Ra(e),this.Qe=new Zu(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new nc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;Ar("MemoryPersistence","Starting transaction:",t);var i=new ac(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return ba.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),ac=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(Tr.c)(e,t),e}(ga),uc=function(){function t(t){this.persistence=t,this.As=new tc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw xr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),ba.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),ba.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),ba.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ba.forEach(this.vs,function(r){var i=ui.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return ba.or([function(){return ba.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),cc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function hc(t,e){return"firestore_clients_"+t+"_"+e}function lc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function fc(t,e){return"firestore_targets_"+t+"_"+e}cc.UNAUTHENTICATED=new cc(null),cc.GOOGLE_CREDENTIALS=new cc("google-credentials-uid"),cc.FIRST_PARTY=new cc("first-party-uid");var dc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Sr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(jr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),pc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Sr(i.error.code,i.error.message)),o?new t(e,i.state,r):(jr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),yc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ss(),s=0;i&&s<r.activeTargetIds.length;++s)i=ai(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(jr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),vc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(jr("SharedClientState","Failed to parse online state: "+e),null)},t}(),gc=function(){function t(){this.activeTargetIds=ss()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),mc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Qo(Fr),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=hc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new gc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(Tr.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(hc(this.persistenceKey,r)))&&(o=yc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.Os;u<c.length;u++)this.Fs(c[u]);return this.Os=[],this.window.addEventListener("unload",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(fc(this.persistenceKey,t));if(n){var r=pc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(fc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ar("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Ar("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Ar("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Ar("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void jr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(Tr.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(Tr.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=_r.o;if(null!=t)try{var n=JSON.parse(t);Rr("number"==typeof n),e=n}catch(t){jr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==_r.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new dc(this.currentUser,t,e,n),i=lc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=lc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=fc(this.persistenceKey,t),i=new pc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return yc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return dc.Vs(new cc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return pc.Vs(r,e)},t.prototype.js=function(t){return vc.Vs(t)},t.prototype.ii=function(t){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Ar("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ss();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),bc=function(){function t(){this.li=new gc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new gc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),wc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Ic=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Ar("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Ar("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Ec={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Tc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),_c=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return Object(Tr.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Er;s.listenOnce(br.COMPLETE,function(){try{switch(s.getLastErrorCode()){case mr.NO_ERROR:var e=s.getResponseJson();Ar("Connection","XHR received:",JSON.stringify(e)),i(e);break;case mr.TIMEOUT:Ar("Connection",'RPC "'+t+'" timed out'),o(new Sr(Or.DEADLINE_EXCEEDED,"Request time out"));break;case mr.HTTP_ERROR:var n=s.getStatus();if(Ar("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Or).indexOf(e)>=0?e:Or.UNKNOWN}(r.status);o(new Sr(a,r.message))}else o(new Sr(Or.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Sr(Or.UNAVAILABLE,"Connection failed."));break;default:xr()}}finally{Ar("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new dr,i=ye(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(o.initMessageHeaders,e),Object(b.m)()||Object(b.o)()||Object(b.k)()||Object(b.l)()||Object(b.p)()||Object(b.j)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Ar("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Tc({Ei:function(t){c?Ar("Connection","Not sending because WebChannel is closed:",t):(u||(Ar("Connection","Opening WebChannel transport."),a.open(),u=!0),Ar("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Ir.EventType.OPEN,function(){c||Ar("Connection","WebChannel transport opened.")}),l(a,Ir.EventType.CLOSE,function(){c||(c=!0,Ar("Connection","WebChannel transport closed"),h.Vi())}),l(a,Ir.EventType.ERROR,function(t){c||(c=!0,kr("Connection","WebChannel transport errored:",t),h.Vi(new Sr(Or.UNAVAILABLE,"The operation could not be completed")))}),l(a,Ir.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Rr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Ar("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=qo[t];if(void 0!==e)return zo(e)}(i),s=r.message;void 0===o&&(o=Or.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Sr(o,s)),a.close()}else Ar("Connection","WebChannel received:",n),h.Si(n)}}),l(i,wr.STAT_EVENT,function(t){10===t.stat?Ar("Connection","Detected buffering proxy"):11===t.stat&&Ar("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Ar("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Ar("RestConnection","Received: ",t),t},function(e){throw kr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.4.0",t["X-Firebase-GMPID"]=this.databaseInfo.appId,t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Ec[t]},t}());function Oc(){return"undefined"!=typeof window?window:null}function Sc(){return"undefined"!=typeof document?document:null}function Dc(t){return new ms(t,!0)}var Nc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&Ar("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Ac=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Nc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Or.RESOURCE_EXHAUSTED?(jr(e.toString()),jr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===Or.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Sr(Or.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(Tr.b)(t,void 0,void 0,function(){return Object(Tr.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Ar("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Ar("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),jc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(Tr.c)(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:xr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Rr(void 0===e||"string"==typeof e),Jr.fromBase64String(e||"")):(Rr(void 0===e||e instanceof Uint8Array),Jr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Or.UNKNOWN:zo(t.code);return new Sr(e,t.message||"")}(a);n=new ls(r,i,o,s||null)}else if("documentChange"in e){i=Ss(t,(r=e.documentChange).document.name),o=Es(r.document.updateTime);var a=new Ei({mapValue:{fields:r.document.fields}}),u=(s=_i.newFoundDocument(i,o,a),r.targetIds||[]);n=new cs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Ss(t,(r=e.documentDelete).document),o=r.readTime?Es(r.readTime):Br.min(),a=_i.newNoDocument(i,o),n=new cs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Ss(t,(r=e.documentRemove).document),n=new cs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return xr();var c=e.filter;i=new Ko(r=c.count||0),n=new hs(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Br.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Br.min():e.readTime?Es(e.readTime):Br.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=As(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Ai(r)?{documents:Ps(t,r)}:{query:Ls(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ws(t,e.resumeToken):e.snapshotVersion.compareTo(Br.min())>0&&(n.readTime=bs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return xr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=As(this.R),e.removeTarget=t,this.cr(e)},e}(Ac),kc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(Tr.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(Rr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Rr(void 0!==e),t.map(function(t){return function(t,e){var n=Es(t.updateTime?t.updateTime:e);return n.isEqual(Br.min())&&(n=Es(e)),new Oo(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Es(t.commitTime);return this.listener.Tr(n,e)}return Rr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=As(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return xs(e.R,t)})};this.cr(n)},e}(Ac),Cc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(Tr.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new Sr(Or.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw t.code===Or.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Oi(t,e,n,i)}).catch(function(t){throw t.code===Or.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},e.prototype.terminate=function(){this.Rr=!1},e}(function(){}),xc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(jr(e),this.Vr=!1):Ar("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Rc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(Tr.b)(o,void 0,void 0,function(){return Object(Tr.d)(this,function(t){switch(t.label){case 0:return Kc(this)?(Ar("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(Tr.b)(this,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return(e=Pr(t)).$r.add(4),[4,Lc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,Pc(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new xc(n,r)};function Pc(t){return Object(Tr.b)(this,void 0,void 0,function(){var e,n;return Object(Tr.d)(this,function(r){switch(r.label){case 0:if(!Kc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Lc(t){return Object(Tr.b)(this,void 0,void 0,function(){var e,n;return Object(Tr.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Mc(t,e){var n=Pr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),Bc(n)?Vc(n):ih(n).er()&&qc(n,e))}function Fc(t,e){var n=Pr(t),r=ih(n);n.Or.delete(e),r.er()&&Uc(n,e),0===n.Or.size&&(r.er()?r.ir():Kc(n)&&n.Br.set("Unknown"))}function qc(t,e){t.qr.U(e.targetId),ih(t).mr(e)}function Uc(t,e){t.qr.U(e),ih(t).yr(e)}function Vc(t){t.qr=new ds({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),ih(t).start(),t.Br.Sr()}function Bc(t){return Kc(t)&&!ih(t).tr()&&t.Or.size>0}function Kc(t){return 0===Pr(t).$r.size}function Gc(t){t.qr=void 0}function zc(t){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(e){return t.Or.forEach(function(e,n){qc(t,e)}),[2]})})}function Qc(t,e){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(n){return Gc(t),Bc(t)?(t.Br.Nr(e),Vc(t)):t.Br.set("Unknown"),[2]})})}function Hc(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i,o;return Object(Tr.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof ls&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Tr.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.Or.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Ar("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Wc(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof cs?t.qr.X(e):e instanceof hs?t.qr.rt(e):t.qr.et(e),n.isEqual(Br.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Vu(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(Jr.EMPTY_BYTE_STRING,n.snapshotVersion)),Uc(t,e);var r=new xa(n.target,e,1,n.sequenceNumber);qc(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Ar("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Wc(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function Wc(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r=this;return Object(Tr.d)(this,function(i){switch(i.label){case 0:if(!_a(e))throw e;return t.$r.add(1),[4,Lc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Vu(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(Tr.b)(r,void 0,void 0,function(){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return Ar("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,Pc(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function Xc(t,e){return e().catch(function(n){return Wc(t,n,e)})}function Yc(t){return Object(Tr.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(Tr.d)(this,function(s){switch(s.label){case 0:e=Pr(t),n=oh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Kc(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Gu(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=oh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Wc(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Jc(e)&&$c(e),[2]}})})}function Jc(t){return Kc(t)&&!oh(t).tr()&&t.kr.length>0}function $c(t){oh(t).start()}function Zc(t){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(e){return oh(t).Ar(),[2]})})}function th(t){return Object(Tr.b)(this,void 0,void 0,function(){var e,n,r;return Object(Tr.d)(this,function(i){for(e=oh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function eh(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Ca.from(r,e,n),[4,Xc(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,Yc(t)];case 2:return o.sent(),[2]}})})}function nh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(n){switch(n.label){case 0:return e&&oh(t).pr?[4,function(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return Go(r=e.code)&&r!==Or.ABORTED?(n=t.kr.shift(),oh(t).sr(),[4,Xc(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,Yc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Jc(t)&&$c(t),[2]}})})}function rh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n;return Object(Tr.d)(this,function(r){switch(r.label){case 0:return n=Pr(t),e?(n.$r.delete(2),[4,Pc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,Lc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function ih(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Pr(t);return r.br(),new jc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:zc.bind(null,t),Ri:Qc.bind(null,t),_r:Hc.bind(null,t)}),t.Mr.push(function(n){return Object(Tr.b)(e,void 0,void 0,function(){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Bc(t)?Vc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Gc(t),e.label=3;case 3:return[2]}})})})),t.Ur}function oh(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=Pr(t);return r.br(),new kc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Zc.bind(null,t),Ri:nh.bind(null,t),Ir:th.bind(null,t),Tr:eh.bind(null,t)}),t.Mr.push(function(n){return Object(Tr.b)(e,void 0,void 0,function(){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,Yc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(Ar("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Qr}var sh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ma,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Sr(Or.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function ah(t,e){if(jr("AsyncQueue",e+": "+t),_a(t))return new Sr(Or.UNAVAILABLE,e+": "+t);throw t}var uh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ui.comparator(e.key,n.key)}:function(t,e){return ui.comparator(t.key,e.key)},this.keyedMap=ts(),this.sortedSet=new Qo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),ch=function(){function t(){this.Kr=new Qo(ui.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):xr():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),hh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,uh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&no(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),lh=function(){this.Wr=void 0,this.listeners=[]},fh=function(){this.queries=new bu(function(t){return ro(t)},no),this.onlineState="Unknown",this.Gr=new Set};function dh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Tr.d)(this,function(c){switch(c.label){case 0:if(n=Pr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new lh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=ah(a,"Initialization of query '"+io(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&gh(n),[2]}})})}function ph(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Tr.d)(this,function(a){return n=Pr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function yh(t,e){for(var n=Pr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&gh(n)}function vh(t,e,n){var r=Pr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function gh(t){t.Gr.forEach(function(t){t.next()})}var mh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new hh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=hh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),bh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),wh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Ss(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Cs(this.R,t.document,!1):_i.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return Es(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new wh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||is()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return[4,Ju(this.localStore,new wh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,$u(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new xu(Object.assign({},this.progress),t))]}})})}}();var Ih=function(t){this.key=t},Eh=function(t){this.key=t},Th=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=is(),this.mutatedKeys=is(),this.lo=so(t),this.fo=new uh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new ch,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Wi(this.query)&&i.size===this.query.limit?i.last():null,c=Xi(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=oo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),Wi(this.query)||Xi(this.query))for(;s.size>this.query.limit;){var h=Wi(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new hh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new ch,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=is(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Eh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Ih(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=is();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return hh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),_h=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Oh=function(t){this.key=t,this.bo=!1},Sh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new bu(function(t){return ro(t)},no),this.Vo=new Map,this.So=new Set,this.Do=new Qo(ui.comparator),this.Co=new Map,this.No=new tc,this.xo={},this.Fo=new Map,this.ko=au.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function Dh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Tr.d)(this,function(a){switch(a.label){case 0:return n=nl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,zu(n.localStore,to(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Nh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&Mc(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Nh(t,e,n,r){return Object(Tr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(Tr.d)(this,function(h){switch(h.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return Object(Tr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Tr.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Hu(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Vh(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,Hu(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Th(e,i.Bn),s=o._o(i.documents),a=us.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Vh(t,n,u.To),c=new _h(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Ah(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return n=Pr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!no(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Qu(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Fc(n.remoteStore,r.targetId),qh(n,r.targetId)}).catch(fu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return qh(n,r.targetId),[4,Qu(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function jh(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Tr.d)(this,function(a){switch(a.label){case 0:r=rl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Pr(t),i=Vr.now(),o=e.reduce(function(t,e){return t.add(e.key)},is());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=ko(c,n.get(c.key));null!=h&&s.push(new Po(c.key,h,Ti(h.toProto().mapValue),So.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Qo(Fr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Gh(r,i.changes)];case 3:return a.sent(),[4,Yc(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=ah(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function kh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r;return Object(Tr.d)(this,function(i){switch(i.label){case 0:n=Pr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Bu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Rr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Rr(r.bo):t.removedDocuments.size>0&&(Rr(r.bo),r.bo=!1))}),[4,Gh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,fu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Ch(t,e,n){var r=Pr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=Pr(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&gh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function xh(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(Tr.d)(this,function(c){switch(c.label){case 0:return(r=Pr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Qo(ui.comparator)).insert(o,_i.newNoDocument(o,Br.min())),a=is().add(o),u=new as(Br.min(),new Map,new Xo(Fr),s,a),[4,kh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Kh(r),[3,4];case 2:return[4,Qu(r.localStore,e,!1).then(function(){return qh(r,e,n)}).catch(fu)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function Rh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Tr.d)(this,function(o){switch(o.label){case 0:n=Pr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Uu(n.localStore,e)];case 2:return i=o.sent(),Fh(n,r,null),Mh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Gh(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,fu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Ph(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i;return Object(Tr.d)(this,function(o){switch(o.label){case 0:r=Pr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Pr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Rr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Fh(r,e,n),Mh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Gh(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,fu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Lh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Tr.d)(this,function(a){switch(a.label){case 0:Kc((n=Pr(t)).remoteStore)||Ar("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Pr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=ah(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function Mh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Fh(t,e,n){var r=Pr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function qh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||Uh(t,e)})}function Uh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Fc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Kh(t))}function Vh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Ih?(t.No.addReference(o.key,e),Bh(t,o)):o instanceof Eh?(Ar("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Uh(t,o.key)):xr()}}function Bh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Ar("SyncEngine","New document in limbo: "+n),t.So.add(r),Kh(t))}function Kh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new ui(Hr.fromString(e)),r=t.ko.next();t.Co.set(r,new Oh(n)),t.Do=t.Do.insert(n,r),Mc(t.remoteStore,new xa(to(Hi(n.path)),r,2,_r.o))}}function Gh(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Tr.d)(this,function(a){switch(a.label){case 0:return r=Pr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.$o(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Pu.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(Tr.d)(this,function(h){switch(h.label){case 0:n=Pr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return ba.forEach(e,function(e){return ba.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return ba.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!_a(r=h.sent()))throw r;return Ar("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function zh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return(n=Pr(t)).currentUser.isEqual(e)?[3,3]:(Ar("SyncEngine","User change. New user:",e.toKey()),[4,qu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Sr(Or.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Gh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function Qh(t,e){var n=Pr(t),r=n.Co.get(e);if(r&&r.bo)return is().add(r.key);var i=is(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function Hh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return[4,Hu((n=Pr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Vh(n,e.targetId,i.To),i)]}})})}function Wh(t){return Object(Tr.b)(this,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){return[2,Xu((e=Pr(t)).localStore).then(function(t){return Gh(e,t)})]})})}function Xh(t,e,n,r){return Object(Tr.b)(this,void 0,void 0,function(){var i,o;return Object(Tr.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=Pr(t),r=Pr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):ba.resolve(null)})})}((i=Pr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Yc(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Fh(i,e,r||null),Mh(i,e),function(t,e){Pr(Pr(t)._n).Gt(e)}(i.localStore,e)):xr(),s.label=4;case 4:return[4,Gh(i,o)];case 5:return s.sent(),[3,7];case 6:Ar("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function Yh(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Tr.d)(this,function(c){switch(c.label){case 0:return nl(n=Pr(t)),rl(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Jh(n,r.toArray())]);case 1:return i=c.sent(),n.Oo=!0,[4,rh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)Mc(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return qh(n,e),Qu(n.localStore,e,!0)}),Fc(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,Jh(n,a)];case 5:return c.sent(),function(t){var e=Pr(t);e.Co.forEach(function(t,n){Fc(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Qo(ui.comparator)}(n),n.Oo=!1,[4,rh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function Jh(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(Tr.d)(this,function(y){switch(y.label){case 0:n=Pr(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,zu(n.localStore,to(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,Hh(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Wu(n.localStore,a)];case 8:return p=y.sent(),[4,zu(n.localStore,p)];case 9:return u=y.sent(),[4,Nh(n,$h(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function $h(t){return Qi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Zh(t){var e=Pr(t);return Pr(Pr(e.localStore).persistence).fn()}function tl(t,e,n,r){return Object(Tr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Tr.d)(this,function(a){switch(a.label){case 0:return(i=Pr(t)).Oo?(Ar("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Xu(i.localStore)];case 3:return o=a.sent(),s=as.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Gh(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Qu(i.localStore,e,!0)];case 6:return a.sent(),qh(i,e,r),[3,8];case 7:xr(),a.label=8;case 8:return[2]}})})}function el(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(Tr.d)(this,function(f){switch(f.label){case 0:if(!(r=nl(t)).Oo)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Ar("SyncEngine","Adding an already active target "+s),[3,5]):[4,Wu(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,zu(r.localStore,a)];case 3:return u=f.sent(),[4,Nh(r,$h(a),u.targetId,!1)];case 4:f.sent(),Mc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Qu(r.localStore,t,!1).then(function(){Fc(r.remoteStore,t),qh(r,t)}).catch(fu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function nl(t){var e=Pr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=kh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Qh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xh.bind(null,e),e.vo._r=yh.bind(null,e.eventManager),e.vo.Mo=vh.bind(null,e.eventManager),e}function rl(t){var e=Pr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Rh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ph.bind(null,e),e}var il=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return this.R=Dc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Fu(this.persistence,new Lu,t.initialUser,this.R)},t.prototype.qo=function(t){return new sc(uc.bs,this.R)},t.prototype.Bo=function(t){return new bc},t.prototype.terminate=function(){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),ol=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(Tr.c)(e,t),e.prototype.initialize=function(e){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Yu(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,rl(this.Ko.syncEngine)];case 4:return n.sent(),[4,Yc(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Qo=function(t){return Fu(this.persistence,new Lu,t.initialUser,this.R)},e.prototype.Uo=function(t){return new yu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Cu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Za.withCacheSize(this.cacheSizeBytes):Za.DEFAULT;return new Au(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Oc(),Sc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new bc},e}(il),sl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(Tr.c)(e,t),e.prototype.initialize=function(e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r=this;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof mc?(this.sharedClientState.syncEngine={ui:Xh.bind(null,n),ai:tl.bind(null,n),hi:el.bind(null,n),fn:Zh.bind(null,n),ci:Wh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(Tr.b)(r,void 0,void 0,function(){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return[4,Yh(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Oc();if(!mc.yt(e))throw new Sr(Or.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Cu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new mc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(ol),al=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n=this;return Object(Tr.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Ch(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=zh.bind(null,this.syncEngine),[4,rh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new fh},t.prototype.createDatastore=function(t){var e=Dc(t.databaseInfo.databaseId),n=new _c(t.databaseInfo);return function(t,e,n){return new Cc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Ch(s.syncEngine,t,0)},o=Ic.yt()?new Ic:new wc,new Rc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Sh(t,e,n,r,i,o);return s&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(Tr.b)(this,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return e=Pr(t),Ar("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,Lc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),ul=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),cl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new ma,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new bh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t,e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(Tr.b)(this,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t,e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(Tr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Tr.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Sr(Or.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(Tr.d)(this,function(u){switch(u.label){case 0:return n=Pr(t),r=As(n.R)+"/documents",i={documents:e.map(function(t){return Os(n.R,t)})},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Rr(!!e.found);var n=Ss(t,e.found.name),r=Es(e.found.updateTime),i=new Ei({mapValue:{fields:e.found.fields}});return _i.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Rr(!!e.missing),Rr(!!e.readTime);var n=Ss(t,e.missing),r=Es(e.readTime);return _i.newNoDocument(n,r)}(t,e):xr()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());Rr(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Vo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Tr.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=ui.fromPath(n);e.mutations.push(new Bo(r,e.precondition(r)))}),[4,function(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return n=Pr(t),r=As(n.R)+"/documents",i={writes:e.map(function(t){return xs(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw xr();e=Br.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Sr(Or.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?So.updateTime(e):So.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Br.min()))throw new Sr(Or.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return So.updateTime(e)}return So.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),hl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Nc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(Tr.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(Tr.d)(this,function(r){return t=new cl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!oi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Go(e)}return!1},t}(),ll=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=cc.UNAUTHENTICATED,this.clientId=Mr.u(),this.credentialListener=function(){},this.receivedInitialUser=new ma,this.credentials.setChangeListener(function(t){Ar("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()})}return t.prototype.getConfiguration=function(){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}})})},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then(function(){return e.credentialListener(e.user)})},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Sr(Or.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new ma;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Tr.b)(t,void 0,void 0,function(){var t,n;return Object(Tr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=ah(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function fl(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Ar("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable(function(){return Object(Tr.b)(i,void 0,void 0,function(){return Object(Tr.d)(this,function(t){switch(t.label){case 0:return[4,qu(e.localStore,n)];case 1:return t.sent(),[2]}})})}))}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function dl(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,pl(t)];case 1:return n=i.sent(),Ar("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(n){return t.asyncQueue.enqueueRetryable(function(){return function(t,e){return Object(Tr.b)(this,void 0,void 0,function(){var n,r;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return(n=Pr(t)).asyncQueue.verifyOperationInProgress(),Ar("RemoteStore","RemoteStore received new credentials"),r=Kc(n),n.$r.add(3),[4,Lc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,Pc(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,n)})}),t.onlineComponents=e,[2]}})})}function pl(t){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Ar("FirestoreClient","Using default OfflineComponentProvider"),[4,fl(t,new il)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function yl(t){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Ar("FirestoreClient","Using default OnlineComponentProvider"),[4,dl(t,new al)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function vl(t){return pl(t).then(function(t){return t.persistence})}function gl(t){return pl(t).then(function(t){return t.localStore})}function ml(t){return yl(t).then(function(t){return t.remoteStore})}function bl(t){return yl(t).then(function(t){return t.syncEngine})}function wl(t){return Object(Tr.b)(this,void 0,void 0,function(){var e,n;return Object(Tr.d)(this,function(r){switch(r.label){case 0:return[4,yl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Dh.bind(null,e.syncEngine),n.onUnlisten=Ah.bind(null,e.syncEngine),n)]}})})}function Il(t,e,n){var r=this;void 0===n&&(n={});var i=new ma;return t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(r,void 0,void 0,function(){var r;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new ul({next:function(o){e.enqueueAndForget(function(){return ph(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Sr(Or.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Sr(Or.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new mh(Hi(n.path),o,{includeMetadataChanges:!0,so:!0});return dh(t,s)},[4,wl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function El(t,e,n){var r=this;void 0===n&&(n={});var i=new ma;return t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(r,void 0,void 0,function(){var r;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new ul({next:function(n){e.enqueueAndForget(function(){return ph(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Sr(Or.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new mh(n,o,{includeMetadataChanges:!0,so:!0});return dh(t,s)},[4,wl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Tl=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},_l=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Ol=new Map,Sl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Dl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(cc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Nl=function(){function t(t){var e=this;this.oc=null,this.currentUser=cc.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then(function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)},function(){}))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Ar("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Rr("string"==typeof n.accessToken),new Sl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return Rr(null===t||"string"==typeof t),new cc(t)},t}(),Al=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=cc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),jl=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new Al(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t(cc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function kl(t,e,n){if(!n)throw new Sr(Or.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Cl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Sr(Or.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function xl(t,e,n,r){if(!0===e&&!0===r)throw new Sr(Or.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Rl(t){if(!ui.isDocumentKey(t))throw new Sr(Or.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Pl(t){if(ui.isDocumentKey(t))throw new Sr(Or.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Ll(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":xr()}function Ml(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Sr(Or.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ll(t);throw new Sr(Or.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Fl(t,e){if(e<=0)throw new Sr(Or.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var ql=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Sr(Or.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Sr(Or.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,xl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Ul=function(){function t(t,e){this._persistenceKey="(lite)",this._settings=new ql({}),this._settingsFrozen=!1,t instanceof _l?(this._databaseId=t,this._credentials=new Dl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Sr(Or.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _l(t.options.projectId)}(t),this._credentials=new Nl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Sr(Or.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Sr(Or.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ql(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Dl;switch(t.type){case"gapi":var e=t.client;return Rr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new jl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Sr(Or.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Ol.get(this))&&(Ar("ComponentProvider","Removing Datastore"),Ol.delete(this),t.terminate()),Promise.resolve();var t},t}(),Vl=function(){function t(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Kl(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Bl=function(){function t(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Kl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Hi(r))||this)._path=r,i.type="collection",i}return Object(Tr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Vl(this.firestore,null,new ui(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Bl);function Gl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(b.g)(t),kl("collection","path",e),t instanceof Ul)return Pl(n=Hr.fromString.apply(Hr,Object(Tr.f)([e],r))),new Kl(t,null,n);if(!(t instanceof Vl||t instanceof Kl))throw new Sr(Or.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Pl(n=Hr.fromString.apply(Hr,Object(Tr.f)([t.path],r)).child(Hr.fromString(e))),new Kl(t.firestore,null,n)}function zl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(b.g)(t),1===arguments.length&&(e=Mr.u()),kl("doc","path",e),t instanceof Ul)return Rl(n=Hr.fromString.apply(Hr,Object(Tr.f)([e],r))),new Vl(t,null,new ui(n));if(!(t instanceof Vl||t instanceof Kl))throw new Sr(Or.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Rl(n=t._path.child(Hr.fromString.apply(Hr,Object(Tr.f)([e],r)))),new Vl(t.firestore,t instanceof Kl?t._converter:null,new ui(n))}function Ql(t,e){return t=Object(b.g)(t),e=Object(b.g)(e),(t instanceof Vl||t instanceof Kl)&&(e instanceof Vl||e instanceof Kl)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function Hl(t,e){return t=Object(b.g)(t),e=Object(b.g)(e),t instanceof Bl&&e instanceof Bl&&t.firestore===e.firestore&&no(t._query,e._query)&&t._converter===e._converter}var Wl=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new Nc(this,"async_queue_retry"),this.Ec=function(){var e=Sc();e&&Ar("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Sc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=Sc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise(function(t){}):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.dc.push(t),e.Ac()})},t.prototype.Ac=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Tr.d)(this,function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!_a(t=n.sent()))throw t;return Ar("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji(function(){return e.Ac()}),n.label=5;case 5:return[2]}})})},t.prototype.Ic=function(t){var e=this,n=this.fc.then(function(){return e.yc=!0,t().catch(function(t){throw e.mc=t,e.yc=!1,jr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.yc=!1,t})});return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=sh.createAndSchedule(this,t,e,n,function(t){return r.Rc(t)});return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&xr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return Object(Tr.b)(this,void 0,void 0,function(){var t;return Object(Tr.d)(this,function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then(function(){e._c.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()})},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function Xl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new ma,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Yl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._queue=new Wl,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(Tr.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||$l(this),this._firestoreClient.terminate()},e}(Ul);function Jl(t){return t._firestoreClient||$l(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function $l(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Tl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ll(t._credentials,t._queue,r)}function Zl(t,e,n){var r=this,i=new ma;return t.asyncQueue.enqueue(function(){return Object(Tr.b)(r,void 0,void 0,function(){var r;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fl(t,n)];case 1:return o.sent(),[4,dl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Or.FAILED_PRECONDITION||t.code===Or.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function tf(t){if(t._initialized||t._terminated)throw new Sr(Or.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var ef=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Sr(Or.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xr(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),nf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Jr.fromBase64String(e))}catch(e){throw new Sr(Or.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Jr.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),rf=function(t){this._methodName=t},of=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Sr(Or.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Sr(Or.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Fr(this._lat,t._lat)||Fr(this._long,t._long)},t}(),sf=/^__.*__$/,af=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Po(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ro(t,this.data,e,this.fieldTransforms)},t}(),uf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Po(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function cf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xr()}}var hf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return jf(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if(cf(this.Dc)&&sf.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),lf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Dc(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new hf({Dc:t,methodName:e,Lc:n,path:Xr.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function ff(t){var e=t._freezeSettings(),n=Dc(t._databaseId);return new lf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function df(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);Sf("Data must be an object, but it was:",s,r);var a,u,c=_f(r,s);if(o.merge)a=new Yr(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Df(e,f[l],n);if(!s.contains(d))throw new Sr(Or.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");kf(h,d)||h.push(d)}a=new Yr(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new af(new Ei(c),a,u)}var pf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Tr.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw t.$c(1===t.Dc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(rf);function yf(t,e,n){return new hf({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var vf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Tr.c)(e,t),e.prototype._toFieldTransform=function(t){return new _o(t.path,new vo)},e.prototype.isEqual=function(t){return t instanceof e},e}(rf),gf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return Object(Tr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=yf(this,t,!0),n=this.qc.map(function(t){return Tf(t,e)}),r=new go(n);return new _o(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(rf),mf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return Object(Tr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=yf(this,t,!0),n=this.qc.map(function(t){return Tf(t,e)}),r=new bo(n);return new _o(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(rf),bf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(Tr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new Io(t.R,ho(t.R,this.Uc));return new _o(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(rf);function wf(t,e,n,r){var i=t.Bc(1,e,n);Sf("Data must be an object, but it was:",i,r);var o=[],s=Ei.empty();Gr(r,function(t,r){var a=Af(e,t,n);r=Object(b.g)(r);var u=i.kc(a);if(r instanceof pf)o.push(a);else{var c=Tf(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new Yr(o);return new uf(s,a,i.fieldTransforms)}function If(t,e,n,r,i,o){var s=t.Bc(1,e,n),a=[Df(e,r,n)],u=[i];if(o.length%2!=0)throw new Sr(Or.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Df(e,o[c])),u.push(o[c+1]);for(var h=[],l=Ei.empty(),f=a.length-1;f>=0;--f)if(!kf(h,a[f])){var d=a[f],p=u[f];p=Object(b.g)(p);var y=s.kc(d);if(p instanceof pf)h.push(d);else{var v=Tf(p,y);null!=v&&(h.push(d),l.set(d,v))}}var g=new Yr(h);return new uf(l,g,s.fieldTransforms)}function Ef(t,e,n,r){return void 0===r&&(r=!1),Tf(n,t.Bc(r?4:3,e))}function Tf(t,e){if(Of(t=Object(b.g)(t)))return Sf("Unsupported field value:",e,t),_f(t,e);if(t instanceof rf)return function(t,e){if(!cf(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Tf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(b.g)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ho(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Vr.fromDate(t);return{timestampValue:bs(e.R,n)}}if(t instanceof Vr)return n=new Vr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:bs(e.R,n)};if(t instanceof of)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof nf)return{bytesValue:ws(e.R,t._byteString)};if(t instanceof Vl){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.$c("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ts(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+Ll(t))}(t,e)}function _f(t,e){var n={};return zr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gr(t,function(t,r){var i=Tf(r,e.Nc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Of(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Vr||t instanceof of||t instanceof nf||t instanceof Vl||t instanceof rf)}function Sf(t,e,n){if(!Of(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Ll(n);throw e.$c("an object"===r?t+" a custom object":t+" "+r)}}function Df(t,e,n){if((e=Object(b.g)(e))instanceof ef)return e._internalPath;if("string"==typeof e)return Af(t,e);throw jf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Nf=new RegExp("[~\\*/\\[\\]]");function Af(t,e,n){if(e.search(Nf)>=0)throw jf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(ef.bind.apply(ef,Object(Tr.f)([void 0],e.split(".")))))._internalPath}catch(r){throw jf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function jf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Sr(Or.INVALID_ARGUMENT,(a+=". ")+t+u)}function kf(t,e){return t.some(function(t){return t.isEqual(e)})}var Cf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Vl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new xf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Rf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),xf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Tr.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Cf);function Rf(t,e){return"string"==typeof e?Af(t,e):e instanceof ef?e._internalPath:e._delegate._internalPath}var Pf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Lf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(Tr.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Mf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Rf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Cf),Mf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Tr.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Lf),Ff=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Pf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Mf(n._firestore,n._userDataWriter,r.key,r,new Pf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Sr(Or.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Mf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Pf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Mf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Pf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:qf(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function qf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xr()}}function Uf(t,e){return t instanceof Lf&&e instanceof Lf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Ff&&e instanceof Ff&&t._firestore===e._firestore&&Hl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Vf(t){if(Xi(t)&&0===t.explicitOrderBy.length)throw new Sr(Or.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Bf=function(){};function Kf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Gf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.Kc=n,i.jc=r,i.type="where",i}return Object(Tr.c)(e,t),e.prototype._apply=function(t){var e=ff(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Sr(Or.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Jf(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(Yf(r,t,h[c]));a={arrayValue:{values:u}}}else a=Yf(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Jf(s,o),a=Ef(n,"where",s,"in"===o||"not-in"===o);var l=ji.create(i,o,a);return function(t,e){if(e.g()){var n=Ji(t);if(null!==n&&!n.isEqual(e.field))throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Yi(t);null!==r&&$f(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Sr(Or.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new Bl(t.firestore,t._converter,function(t,e){var n=t.filters.concat([e]);return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Bf),zf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Wc=n,r.type="orderBy",r}return Object(Tr.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Vi(e,n);return function(t,e){if(null===Yi(t)){var n=Ji(t);null!==n&&$f(0,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new Bl(t.firestore,t._converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new zi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Bf),Qf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Gc=n,i.zc=r,i}return Object(Tr.c)(e,t),e.prototype._apply=function(t){return new Bl(t.firestore,t._converter,eo(t._query,this.Gc,this.zc))},e}(Bf),Hf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(Tr.c)(e,t),e.prototype._apply=function(t){var e=Xf(t,this.type,this.Hc,this.Jc);return new Bl(t.firestore,t._converter,function(t,e){return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Bf),Wf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(Tr.c)(e,t),e.prototype._apply=function(t){var e=Xf(t,this.type,this.Hc,this.Jc);return new Bl(t.firestore,t._converter,function(t,e){return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Bf);function Xf(t,e,n,r){if(n[0]=Object(b.g)(n[0]),n[0]instanceof Cf)return function(t,e,n,r,i){if(!r)throw new Sr(Or.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Zi(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(vi(e,r.key));else{var c=r.data.field(u.field);if(ni(c))throw new Sr(Or.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new qi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=ff(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Sr(Or.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!$i(t)&&-1!==c.indexOf("/"))throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Hr.fromString(c));if(!ui.isDocumentKey(h))throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new ui(h);a.push(vi(e,l))}else{var f=Ef(n,r,c);a.push(f)}}return new qi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Yf(t,e,n){if("string"==typeof(n=Object(b.g)(n))){if(""===n)throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!$i(e)&&-1!==n.indexOf("/"))throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Hr.fromString(n));if(!ui.isDocumentKey(r))throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return vi(t,new ui(r))}if(n instanceof Vl)return vi(t,n._key);throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ll(n)+".")}function Jf(t,e){if(!Array.isArray(t)||0===t.length)throw new Sr(Or.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Sr(Or.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function $f(t,e,n){if(!n.isEqual(e))throw new Sr(Or.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Zf=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),ci(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ti(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ei(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw xr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Gr(t.fields||{},function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new of(ti(t.latitude),ti(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=ri(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ii(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Zr(t);return new Vr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Hr.fromString(t);Rr(Ws(n));var r=new _l(n.get(1),n.get(3)),i=new ui(n.popFirst(5));return r.isEqual(e)||jr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function td(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var ed=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Tr.c)(e,t),e.prototype.convertBytes=function(t){return new nf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Vl(this.firestore,null,e)},e}(Zf),nd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=ff(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=rd(t,this._firestore),i=td(r._converter,e,n),o=df(this._dataReader,"WriteBatch.set",r._key,i,null!==r._converter,n);return this._mutations.push(o.toMutation(r._key,So.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=rd(t,this._firestore);return o="string"==typeof(e=Object(b.g)(e))||e instanceof ef?If(this._dataReader,"WriteBatch.update",s._key,e,n,r):wf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,So.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=rd(t,this._firestore);return this._mutations=this._mutations.concat(new Vo(e._key,So.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Sr(Or.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function rd(t,e){if((t=Object(b.g)(t)).firestore!==e)throw new Sr(Or.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var id=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Tr.c)(e,t),e.prototype.convertBytes=function(t){return new nf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Vl(this.firestore,null,e)},e}(Zf);function od(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Ml(t,Vl);var o=Ml(t.firestore,Yl),s=ff(o);return ad(o,[("string"==typeof(e=Object(b.g)(e))||e instanceof ef?If(s,"updateDoc",t._key,e,n,r):wf(s,"updateDoc",t._key,e)).toMutation(t._key,So.exists(!0))])}function sd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(b.g)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||Xl(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(Xl(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Vl)c=Ml(t.firestore,Yl),h=Hi(t._key.path),u={next:function(e){i[a]&&i[a](ud(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Ml(t,Bl);c=Ml(d.firestore,Yl),h=d._query;var p=new id(c);u={next:function(t){i[a]&&i[a](new Ff(c,p,d,t))},error:i[a+1],complete:i[a+2]},Vf(t._query)}return function(t,e,n,r){var i=this,o=new ul(r),s=new mh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(i,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return e=dh,[4,wl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(i,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return e=ph,[4,wl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(Jl(c),h,l,u)}function ad(t,e){return function(t,e){var n=this,r=new ma;return t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(n,void 0,void 0,function(){var n;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return n=jh,[4,bl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(Jl(t),e)}function ud(t,e,n){var r=n.docs.get(e._key),i=new id(t);return new Lf(t,i,e._key,r,new Pf(n.hasPendingWrites,n.fromCache),e._converter)}var cd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(Tr.c)(e,t),e.prototype.get=function(e){var n=this,r=rd(e,this._firestore),i=new id(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Lf(n._firestore,i,r._key,t._document,new Pf(!1,!1),r._converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=ff(t)}return t.prototype.get=function(t){var e=this,n=rd(t,this._firestore),r=new ed(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return xr();var i=t[0];if(i.isFoundDocument())return new Cf(e._firestore,r,i.key,i,n._converter);if(i.isNoDocument())return new Cf(e._firestore,r,n._key,null,n._converter);throw xr()})},t.prototype.set=function(t,e,n){var r=rd(t,this._firestore),i=td(r._converter,e,n),o=df(this._dataReader,"Transaction.set",r._key,i,null!==r._converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=rd(t,this._firestore);return o="string"==typeof(e=Object(b.g)(e))||e instanceof ef?If(this._dataReader,"Transaction.update",s._key,e,n,r):wf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=rd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function hd(){if("undefined"==typeof Uint8Array)throw new Sr(Or.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ld(){if("undefined"==typeof atob)throw new Sr(Or.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var fd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return ld(),new t(nf.fromBase64String(e))},t.fromUint8Array=function(e){return hd(),new t(nf.fromUint8Array(e))},t.prototype.toBase64=function(){return ld(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return hd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),dd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){tf(t=Ml(t,Yl));var n=Jl(t),r=t._freezeSettings(),i=new al;return Zl(n,i,new ol(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){tf(t=Ml(t,Yl));var e=Jl(t),n=t._freezeSettings(),r=new al;return Zl(e,r,new sl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Sr(Or.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new ma;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Tr.b)(e,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(Tr.b)(this,void 0,void 0,function(){return Object(Tr.d)(this,function(e){switch(e.label){case 0:return Ia.yt()?[4,Ia.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Cu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),pd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof _l||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=Ml(t,Ul))._getSettings();"firestore.googleapis.com"!==r.host&&r.host!==e&&kr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:e+":"+n,ssl:!1}))}(this._delegate,t,e)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Tr.b)(e,void 0,void 0,function(){var e,n;return Object(Tr.d)(this,function(r){switch(r.label){case 0:return[4,vl(t)];case 1:return e=r.sent(),[4,ml(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Pr(t);return e.$r.delete(0),Pc(e)}(n))]}})})})}(Jl(Ml(this._delegate,Yl)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Tr.b)(e,void 0,void 0,function(){var e,n;return Object(Tr.d)(this,function(r){switch(r.label){case 0:return[4,vl(t)];case 1:return e=r.sent(),[4,ml(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(Tr.b)(this,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return(e=Pr(t)).$r.add(0),[4,Lc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Jl(Ml(this._delegate,Yl)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&xl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new ma;return t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(e,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(r){switch(r.label){case 0:return e=Lh,[4,bl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(Jl(Ml(this._delegate,Yl)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new ul(e);return t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(n,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Pr(t).Gr.add(e),e.next()},[4,wl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(n,void 0,void 0,function(){var e;return Object(Tr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Pr(t).Gr.delete(e)},[4,wl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(Jl(t=Ml(t,Yl)),Xl(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new Sr(Or.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Nd(this,Gl(this._delegate,t))}catch(t){throw wd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new bd(this,zl(this._delegate,t))}catch(t){throw wd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Od(this,function(t,e){if(t=Ml(t,Ul),kl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Sr(Or.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Bl(t,null,function(t){return new zi(Hr.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw wd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new ma;return t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(n,void 0,void 0,function(){var n;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return yl(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new hl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(Jl(t),function(n){return e(new cd(t,n))})}(this._delegate,function(n){return t(new vd(e,n))})},t.prototype.batch=function(){var t=this;return Jl(this._delegate),new gd(new nd(this._delegate,function(e){return ad(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Sr(Or.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Sr(Or.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),yd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Tr.c)(e,t),e.prototype.convertBytes=function(t){return new fd(new nf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return bd.Zc(e,this.firestore,null)},e}(Zf),vd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new yd(t)}return t.prototype.get=function(t){var e=this,n=Ad(t);return this._delegate.get(n).then(function(t){return new Td(e._firestore,new Lf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))})},t.prototype.set=function(t,e,n){var r=Ad(t);return n?(Cl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ad(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Tr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ad(t);return this._delegate.delete(e),this},t}(),gd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Ad(t);return n?(Cl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ad(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Tr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ad(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),md=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Mf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new _d(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new yd(e),n),i.set(n,o)),o},t}();md.eu=new WeakMap;var bd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new yd(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new Sr(Or.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Vl(n._delegate,r,new ui(e)))},t.Zc=function(e,n,r){return new t(n,new Vl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Nd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Nd(this.firestore,Gl(this._delegate,t))}catch(t){throw wd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(b.g)(t))instanceof Vl&&Ql(this._delegate,t)},t.prototype.set=function(t,e){e=Cl("DocumentReference.set",e);try{return function(t,e,n){t=Ml(t,Vl);var r=Ml(t.firestore,Yl),i=td(t._converter,e,n);return ad(r,[df(ff(r),"setDoc",t._key,i,null!==t._converter,n).toMutation(t._key,So.none())])}(this._delegate,t,e)}catch(t){throw wd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?od(this._delegate,t):od.apply(void 0,Object(Tr.f)([this._delegate,t,e],n))}catch(t){throw wd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return ad(Ml((t=this._delegate).firestore,Yl),[new Vo(t._key,So.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Id(e),i=Ed(e,function(e){return new Td(t.firestore,new Lf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))});return sd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ml(t,Vl);var e=Ml(t.firestore,Yl),n=Jl(e),r=new id(e);return function(t,e){var n=this,r=new ma;return t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(n,void 0,void 0,function(){var n;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i;return Object(Tr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Pr(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Sr(Or.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=ah(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,gl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new Lf(e,r,t._key,n,new Pf(null!==n&&n.hasLocalMutations,!0),t._converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ml(t,Vl);var e=Ml(t.firestore,Yl);return Il(Jl(e),t._key,{source:"server"}).then(function(n){return ud(e,t,n)})}(this._delegate):function(t){t=Ml(t,Vl);var e=Ml(t.firestore,Yl);return Il(Jl(e),t._key).then(function(n){return ud(e,t,n)})}(this._delegate)).then(function(t){return new Td(e.firestore,new Lf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?md.tu(this.firestore,e):null))},t}();function wd(t,e,n){return t.message=t.message.replace(e,n),t}function Id(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Xl(r))return r}return{}}function Ed(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Xl(t[0])?t[0]:Xl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Td=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new bd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Uf(this._delegate,t._delegate)},t}(),_d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Tr.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Td),Od=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new yd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Kf(this._delegate,function(t,e,n){var r=e,i=Rf("where",t);return new Gf(i,r,n)}(e,n,r)))}catch(e){throw wd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Kf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Rf("orderBy",t);return new zf(r,n)}(e,n)))}catch(e){throw wd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Kf(this._delegate,function(t){return Fl("limit",t),new Qf("limit",t,"F")}(e)))}catch(e){throw wd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Kf(this._delegate,function(t){return Fl("limitToLast",t),new Qf("limitToLast",t,"L")}(e)))}catch(e){throw wd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Kf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hf("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw wd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Kf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hf("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw wd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Kf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wf("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw wd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Kf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wf("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw wd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Hl(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ml(t,Bl);var e=Ml(t.firestore,Yl),n=Jl(e),r=new id(e);return function(t,e){var n=this,r=new ma;return t.asyncQueue.enqueueAndForget(function(){return Object(Tr.b)(n,void 0,void 0,function(){var n;return Object(Tr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Tr.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(Tr.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Hu(t,e,!0)];case 1:return a=u.sent(),r=new Th(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=ah(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,gl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new Ff(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ml(t,Bl);var e=Ml(t.firestore,Yl),n=Jl(e),r=new id(e);return El(n,t._query,{source:"server"}).then(function(n){return new Ff(e,r,t,n)})}(this._delegate):function(t){t=Ml(t,Bl);var e=Ml(t.firestore,Yl),n=Jl(e),r=new id(e);return Vf(t._query),El(n,t._query).then(function(n){return new Ff(e,r,t,n)})}(this._delegate)).then(function(t){return new Dd(e.firestore,new Ff(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Id(e),i=Ed(e,function(e){return new Dd(t.firestore,new Ff(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return sd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?md.tu(this.firestore,e):null))},t}(),Sd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new _d(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Dd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Od(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new _d(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Sd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new _d(n._firestore,r))})},t.prototype.isEqual=function(t){return Uf(this._delegate,t._delegate)},t}(),Nd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(Tr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new bd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new bd(this.firestore,void 0===t?zl(this._delegate):zl(this._delegate,t))}catch(t){throw wd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Ml(t.firestore,Yl),r=zl(t),i=td(t._converter,e);return ad(n,[df(ff(t.firestore),"addDoc",r._key,i,null!==t._converter,{}).toMutation(r._key,So.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new bd(e.firestore,t)})},e.prototype.isEqual=function(t){return Ql(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?md.tu(this.firestore,t):null))},e}(Od);function Ad(t){return Ml(t,Vl)}var jd,kd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(ef.bind.apply(ef,Object(Tr.f)([void 0],t)))}return t.documentId=function(){return new t(Xr.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(b.g)(t))instanceof ef&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Cd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new vf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new pf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new mf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new bf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),xd=n("/6Yf"),Rd={Firestore:pd,GeoPoint:of,Timestamp:Vr,Blob:fd,Transaction:vd,WriteBatch:gd,DocumentReference:bd,DocumentSnapshot:Td,Query:Od,QueryDocumentSnapshot:_d,QuerySnapshot:Dd,CollectionReference:Nd,FieldPath:kd,FieldValue:Cd,setLogLevel:function(t){Dr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new xd.a("firestore",function(t){return function(t,e){return new pd(t,new Yl(t,e),new dd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Rd)))})(jd=m.a),jd.registerVersion("@firebase/firestore","2.2.4");var Pd=n("UbJi");function Ld(t,e){return function(t,e=i.b){return new o.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Md(t,e){return Ld(t,e).pipe(Object(h.a)(t=>({payload:t,type:"query"})))}function Fd(t,e){return Md(t,e).pipe(Object(u.a)(void 0),Object(c.a)(),Object(h.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function qd(t,e,n){return Fd(t,n).pipe(Object(l.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Ud(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Ud(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Ud(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(f.a)(),Object(h.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function Ud(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function Vd(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class Bd{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=Fd(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(h.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(u.a)(void 0),Object(c.a)(),Object(d.a)(([t,e])=>e.length>0||!t),Object(h.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(l.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Vd(t);return qd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Md(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new Kd(this.ref.doc(t),this.afs)}}class Kd{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=Xd(n,e);return new Bd(r,i,this.afs)}snapshotChanges(){return Ld(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(void 0),Object(c.a)(),Object(h.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(h.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(s.a)(this.ref.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}}class Gd{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?Fd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(d.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):Fd(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(l.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Vd(t);return qd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Md(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}}const zd=new r.s("angularfire2.enableFirestorePersistence"),Qd=new r.s("angularfire2.firestore.persistenceSettings"),Hd=new r.s("angularfire2.firestore.settings"),Wd=new r.s("angularfire2.firestore.use-emulator");function Xd(t,e=(t=>t)){return{query:e(t),ref:t}}let Yd=(()=>{class t{constructor(t,e,n,r,i,o,u,c,h){this.schedulers=new y.d(o),this.keepUnstableUntilFirst=Object(y.h)(this.schedulers);const l=Object(y.g)(t,o,e);!g.a.auth&&h&&Object(y.j)();const f=c;[this.firestore,this.persistenceEnabled$]=Object(y.f)(`${l.name}.firestore`,"AngularFirestore",l,()=>{const t=o.runOutsideAngular(()=>l.firestore());if(r&&t.settings(r),f&&t.useEmulator(...f),n&&!Object(v.o)(i)){const e=()=>{try{return Object(s.a)(t.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(jd){return"undefined"!=typeof console&&console.warn(jd),Object(a.a)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,Object(a.a)(!1)]},[r,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=Xd(n,e),o=this.schedulers.ngZone.run(()=>r);return new Bd(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new Gd(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new Kd(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(r.Xb(y.c),r.Xb(y.b,8),r.Xb(zd,8),r.Xb(Hd,8),r.Xb(r.D),r.Xb(r.B),r.Xb(Qd,8),r.Xb(Wd,8),r.Xb(Pd.c,8))},t.\u0275prov=Object(r.Jb)({factory:function(){return new t(Object(r.Xb)(y.c),Object(r.Xb)(y.b,8),Object(r.Xb)(zd,8),Object(r.Xb)(Hd,8),Object(r.Xb)(r.D),Object(r.Xb)(r.B),Object(r.Xb)(Qd,8),Object(r.Xb)(Wd,8),Object(r.Xb)(Pd.c,8))},token:t,providedIn:"any"}),t})()},"Y/7H":function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n("mrSG"),i=n("lJxs"),o=n("fXoL"),s=n("I/3d");let a=(()=>{class t{constructor(t){this.afs=t,this.decksCollection=t.collection("decks"),this.getDecks()}deleteDecks(t){return new Promise((e,n)=>Object(r.b)(this,void 0,void 0,function*(){try{yield this.decksCollection.doc(t).delete()}catch(e){n(e.message)}}))}saveDecks(t,e,n,i,o){return new Promise((s,a)=>Object(r.b)(this,void 0,void 0,function*(){try{const r=e||this.afs.createId(),s=Object.assign({id:r,cards:n,rep:i,img:"assets/dorso.png",uid:o},t);yield this.decksCollection.doc(r).set(s)}catch(r){a(r.message)}}))}getDecks(){this.decks=this.decksCollection.snapshotChanges().pipe(Object(i.a)(t=>t.map(t=>t.payload.doc.data())))}}return t.\u0275fac=function(e){return new(e||t)(o.Xb(s.a))},t.\u0275prov=o.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);